<!DOCTYPE html>
<html lang="en">
  
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Typelevel Laika + Helium Theme" />
  <title>JSON Queries</title>
  
  <meta name="author" content="Lucas Satabin"/>
  
  <meta name="author" content="Yannick Heiber"/>
  
  
  <meta name="description" content="site"/>
  
  
  
  <link rel="icon" sizes="32x32" type="image/png" href="https://typelevel.org/img/favicon.png"/>
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700">
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:500">
  
  <link rel="stylesheet" type="text/css" href="/pagefind/pagefind-ui.css" />
    <link rel="stylesheet" type="text/css" href="../../../helium/site/icofont.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../helium/site/laika-helium.css" />
  <script src="/pagefind/pagefind-ui.js"></script>
    <script src="../../../helium/site/laika-helium.js"></script>
  
  
  <script> /* for avoiding page load transitions */ </script>
</head>

  <body>

    <header id="top-bar" class="light-default dark-default">

  <div class="row">
    <a id="nav-icon">
      <i class="icofont-laika navigationMenu" title="Navigation">&#xefa2;</i>
    </a>
    
    
  </div>

  <a class="image-link" href="../../../"><img src="../../../media/logo-header.svg"></a>

  <div class="row links">
    
    <a class="icon-link svg-link" href="https://www.javadoc.io/doc/org.gnieh/fs2-data-docs_2.13/1.11.0/fs2/data/index.html"><span class="api" title="API"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M75,47.5c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm-50,-0c13.246,-0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,-0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm2.705,16.735l7.239,0l0.622,-4.904l-21.833,0l-0,4.904l7.589,0l0,22.067l6.383,0l-0,-22.067Zm58.076,7.265c-0,-8.757 -3.698,-14.166 -10.781,-14.166c-7.083,-0 -10.781,5.604 -10.781,14.166c0,8.757 3.698,14.166 10.781,14.166c7.083,0 10.781,-5.604 10.781,-14.166Zm-6.539,0c0,6.538 -1.128,9.496 -4.242,9.496c-2.997,0 -4.242,-2.88 -4.242,-9.496c-0,-6.616 1.206,-9.496 4.242,-9.496c3.036,-0 4.242,2.88 4.242,9.496Zm-29.242,-67c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm0.512,9.834c-7.122,-0 -12.609,5.098 -12.609,14.127c-0,9.263 5.215,14.205 12.532,14.205c4.164,0 7.083,-1.634 9.068,-3.658l-2.88,-3.697c-1.518,1.206 -3.153,2.413 -5.838,2.413c-3.697,-0 -6.266,-2.763 -6.266,-9.263c-0,-6.616 2.724,-9.379 6.149,-9.379c2.102,-0 3.892,0.778 5.371,1.984l3.113,-3.775c-2.257,-1.868 -4.748,-2.957 -8.64,-2.957Z"/>
  </g>
</svg></span></a>
    
    <a class="icon-link svg-link" href="https://github.com/gnieh/fs2-data"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
    <a class="icon-link glyph-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika chat" title="Chat">&#xeed5;</i></a>
    
    <a class="icon-link svg-link" href="https://fosstodon.org/@lucassatabin"><span class="mastodon" title="Mastodon"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <g class="svg-shape">
    <path d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a3.614 3.614 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522c0-.859.22-1.541.66-2.046.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764.442.505.661 1.187.661 2.046v4.203z"/>
  </g>
</svg></span></a>
    
  </div>  

</header>
    
    <nav id="sidebar">

  <div class="row">
    
    <a class="icon-link svg-link" href="https://www.javadoc.io/doc/org.gnieh/fs2-data-docs_2.13/1.11.0/fs2/data/index.html"><span class="api" title="API"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M75,47.5c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm-50,-0c13.246,-0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,-0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm2.705,16.735l7.239,0l0.622,-4.904l-21.833,0l-0,4.904l7.589,0l0,22.067l6.383,0l-0,-22.067Zm58.076,7.265c-0,-8.757 -3.698,-14.166 -10.781,-14.166c-7.083,-0 -10.781,5.604 -10.781,14.166c0,8.757 3.698,14.166 10.781,14.166c7.083,0 10.781,-5.604 10.781,-14.166Zm-6.539,0c0,6.538 -1.128,9.496 -4.242,9.496c-2.997,0 -4.242,-2.88 -4.242,-9.496c-0,-6.616 1.206,-9.496 4.242,-9.496c3.036,-0 4.242,2.88 4.242,9.496Zm-29.242,-67c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm0.512,9.834c-7.122,-0 -12.609,5.098 -12.609,14.127c-0,9.263 5.215,14.205 12.532,14.205c4.164,0 7.083,-1.634 9.068,-3.658l-2.88,-3.697c-1.518,1.206 -3.153,2.413 -5.838,2.413c-3.697,-0 -6.266,-2.763 -6.266,-9.263c-0,-6.616 2.724,-9.379 6.149,-9.379c2.102,-0 3.892,0.778 5.371,1.984l3.113,-3.775c-2.257,-1.868 -4.748,-2.957 -8.64,-2.957Z"/>
  </g>
</svg></span></a>
    
    <a class="icon-link svg-link" href="https://github.com/gnieh/fs2-data"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
    <a class="icon-link glyph-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika chat" title="Chat">&#xeed5;</i></a>
    
    <a class="icon-link svg-link" href="https://fosstodon.org/@lucassatabin"><span class="mastodon" title="Mastodon"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <g class="svg-shape">
    <path d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a3.614 3.614 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522c0-.859.22-1.541.66-2.046.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764.442.505.661 1.187.661 2.046v4.203z"/>
  </g>
</svg></span></a>
    
  </div>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="../../../">Home</a></li>
    <li class="level1 nav-header">documentation</li>
    <li class="level2 nav-leaf"><a href="../../">Introduction</a></li>
    <li class="level2 nav-header">csv</li>
    <li class="level3 nav-leaf"><a href="../../csv/">Introduction</a></li>
    <li class="level3 nav-leaf"><a href="../../csv/generic/">Generic</a></li>
    <li class="level2 nav-header">json</li>
    <li class="level3 nav-leaf"><a href="../">Introduction</a></li>
    <li class="level3 nav-leaf"><a href="../jsonpath/">JSONPath</a></li>
    <li class="level3 active nav-leaf"><a href="#">JSON Queries</a></li>
    <li class="level3 nav-leaf"><a href="../libraries/">JSON Libraries</a></li>
    <li class="level3 nav-leaf"><a href="../jsonpatch/">JSON Patch</a></li>
    <li class="level3 nav-leaf"><a href="../transformations/">Transformations</a></li>
    <li class="level2 nav-header">xml</li>
    <li class="level3 nav-leaf"><a href="../../xml/">Introduction</a></li>
    <li class="level3 nav-leaf"><a href="../../xml/xpath/">XPath</a></li>
    <li class="level3 nav-leaf"><a href="../../xml/libraries/">XML Libraries</a></li>
    <li class="level2 nav-header">cbor</li>
    <li class="level3 nav-leaf"><a href="../../cbor/">Introduction</a></li>
    <li class="level2 nav-header">cbor-json</li>
    <li class="level3 nav-leaf"><a href="../../cbor-json/">Introduction</a></li>
    <li class="level1 nav-header">cookbooks</li>
    <li class="level2 nav-leaf"><a href="../../../cookbooks/jq/">Reading/transforming/writing JSON data</a></li>
    <li class="level2 nav-leaf"><a href="../../../cookbooks/jsonlines/">Handling JSON Lines data</a></li>
  </ul>

  <ul class="nav-list">
    <li><div id="search"></div></li>
  </ul>

</nav>

<script>
window.addEventListener('DOMContentLoaded', (event) => {
  new PagefindUI({ element: "#search", showSubResults: true, showImages: false });
});
</script>


    <div id="container">

      
<nav id="page-nav">
  <p class="header"><a href="#">JSON Queries</a></p>

  <ul class="nav-list">
    <li class="level1 nav-node"><a href="#building-a-query">Building a query</a></li>
    <li class="level2 nav-leaf"><a href="#parsing-a-string-using-the-jq-parser">Parsing a string using the jq parser</a></li>
    <li class="level1 nav-node"><a href="#the-query-language">The query language</a></li>
    <li class="level2 nav-leaf"><a href="#the-filters">The filters</a></li>
    <li class="level2 nav-leaf"><a href="#the-constructors">The constructors</a></li>
    <li class="level2 nav-leaf"><a href="#values">Values</a></li>
    <li class="level1 nav-leaf"><a href="#using-queries">Using queries</a></li>
  </ul>

  <p class="footer"></p>
</nav>


      <main class="content">

        <h1 id="json-queries" class="title">JSON Queries</h1>
        <p>Module: <a href="https://mvnrepository.com/artifact/org.gnieh/fs2-data-json_2.13"><img src="https://img.shields.io/maven-central/v/org.gnieh/fs2-data-json_2.13.svg" alt="Maven Central"></a></p>
        <p>The <code>fs2-data-json</code> module provides a streaming implementation of a <a href="https://jqlang.github.io/jq/">jq</a>-like query language.</p>
        <p>This allows for extracting and transforming JSON data in a streaming and declarative fashion.
        It can be useful when you want to extract and transform only a part of an input JSON data.</p>
        <div class="callout info">
          <i class="icofont-laika info">&#xef4e;</i>
          <p>The JSON query feature is still <strong>experimental</strong>. It should be stable enough to be used but you can come across some bugs when using complex queries. In such a case, do not hesitate to reach out on Discord or GitHub (see link at the top of the page).</p>
        </div>
        <p>Let&#39;s use the following JSON input as an example.</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">effect</span><span>.</span><span class="type-name">SyncIO</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">syntax</span><span>.</span><span class="identifier">all</span><span>.</span><span class="identifier">_</span><span>

</span><span class="keyword">import</span><span> </span><span class="identifier">fs2</span><span>.</span><span class="identifier">_</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">fs2</span><span>.</span><span class="identifier">data</span><span>.</span><span class="identifier">json</span><span>.</span><span class="identifier">_</span><span>

</span><span class="keyword">val</span><span> </span><span class="identifier">input</span><span> = </span><span class="string-literal">&quot;&quot;&quot;{
              |  &quot;field1&quot;: 0,
              |  &quot;field2&quot;: &quot;test&quot;,
              |  &quot;field3&quot;: [1, 2, 3]
              |}&quot;&quot;&quot;</span><span>.</span><span class="identifier">stripMargin</span><span>
</span><span class="comment">// input: String = &quot;&quot;&quot;{
//   &quot;field1&quot;: 0,
//   &quot;field2&quot;: &quot;test&quot;,
//   &quot;field3&quot;: [1, 2, 3]
// }&quot;&quot;&quot;
</span><span>
</span><span class="keyword">val</span><span> </span><span class="identifier">stream</span><span> = </span><span class="type-name">Stream</span><span>.</span><span class="identifier">emit</span><span>(</span><span class="identifier">input</span><span>).</span><span class="identifier">through</span><span>(</span><span class="identifier">tokens</span><span>[</span><span class="type-name">SyncIO</span><span>, </span><span class="type-name">String</span><span>])
</span><span class="comment">// stream: Stream[[A]SyncIO[A], Token] = Stream(..)</span></code></pre>
        
        <h2 id="building-a-query" class="section"><a class="anchor-link left" href="#building-a-query"><i class="icofont-laika link">&#xef71;</i></a>Building a query</h2>
        <p>There are several ways to create queries:</p>
        <ul>
          <li>build the query using the constructors, which can be quite verbose and cumbersome;</li>
        </ul>
        <ul>
          <li>parse a string with the jq parser;</li>
        </ul>
        <ul>
          <li>use the <code>jq</code> interpolator.</li>
        </ul>
        
        <h3 id="parsing-a-string-using-the-jq-parser" class="section"><a class="anchor-link left" href="#parsing-a-string-using-the-jq-parser"><i class="icofont-laika link">&#xef71;</i></a>Parsing a string using the jq parser</h3>
        <p>For instance, to create an output array containing one element per element in <code>field3</code>, elements being objects with <code>field2</code> and the current value from <code>field3</code> we can write:</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">fs2</span><span>.</span><span class="identifier">data</span><span>.</span><span class="identifier">json</span><span>.</span><span class="identifier">jq</span><span>.</span><span class="identifier">_</span><span>

</span><span class="keyword">val</span><span> </span><span class="identifier">wrappedQuery</span><span> = </span><span class="type-name">JqParser</span><span>.</span><span class="identifier">either</span><span>(</span><span class="string-literal">&quot;&quot;&quot;[ { &quot;field2&quot;: .field2, &quot;field3&quot;: .field3[] } ]&quot;&quot;&quot;</span><span>)
</span><span class="comment">// wrappedQuery: Either[Throwable, Jq] = Right(
//   value = Arr(
//     prefix = Identity,
//     values = List(
//       Obj(
//         prefix = Identity,
//         fields = List(
//           (&quot;field2&quot;, Field(name = &quot;field2&quot;)),
//           (
//             &quot;field3&quot;,
//             Iterator(filter = Field(name = &quot;field3&quot;), inner = Identity)
//           )
//         )
//       )
//     )
//   )
// )</span></code></pre>
        <p>The jq parser wraps the result in anything that has an <a href="https://typelevel.org/cats/api/cats/MonadError.html"><code>MonadError</code> with error type <code>Throwable</code></a> to catch potential parsing errors. If you prefer not to have this wrapping, you can use the <code>jq</code> interpolator.</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">fs2</span><span>.</span><span class="identifier">data</span><span>.</span><span class="identifier">json</span><span>.</span><span class="identifier">jq</span><span>.</span><span class="identifier">literals</span><span>.</span><span class="identifier">_</span><span>

</span><span class="keyword">val</span><span> </span><span class="identifier">query</span><span> = </span><span class="string-literal">jq&quot;&quot;&quot;[ { &quot;field2&quot;: .field2, &quot;field3&quot;: .field3[] } ]&quot;&quot;&quot;</span><span>
</span><span class="comment">// query: Jq = Arr(
//   prefix = Identity,
//   values = List(
//     Obj(
//       prefix = Identity,
//       fields = List(
//         (&quot;field2&quot;, Field(name = &quot;field2&quot;)),
//         (&quot;field3&quot;, Iterator(filter = Field(name = &quot;field3&quot;), inner = Identity))
//       )
//     )
//   )
// )</span></code></pre>
        
        <h2 id="the-query-language" class="section"><a class="anchor-link left" href="#the-query-language"><i class="icofont-laika link">&#xef71;</i></a>The query language</h2>
        <p>The general form of a query is a two phases process:</p>
        <ul>
          <li>A potential <em>filtering</em> phase, which selects some elements from the input stream. If the selector is not provided, then the input value is selected as a whole.</li>
        </ul>
        <ul>
          <li>A potential <em>construction</em> phase, which builds the output based on the elements selected by the selection phase. If the constructor is not provided, then the selected elements are emitted unchanged.</li>
        </ul>
        <p>The constructor can contain sub-queries applied to each selected element.</p>
        <p>So a query is of the form:</p>
        <ul>
          <li><code>filter</code> to just apply a selection to input (think <a href="../jsonpath/">JSONPath</a>).</li>
        </ul>
        <ul>
          <li><code>filter | constructor</code> to select only a subset of the input and build the result out of the selected elements.</li>
        </ul>
        <ul>
          <li><code>constructor</code> to build the result from the input top-value.</li>
        </ul>
        
        <h3 id="the-filters" class="section"><a class="anchor-link left" href="#the-filters"><i class="icofont-laika link">&#xef71;</i></a>The filters</h3>
        <p>Following filters exist:</p>
        <ul>
          <li><code>.</code> is the identity filter, that selects the current value.</li>
        </ul>
        <ul>
          <li><code>.field</code> or <code>.[&quot;field&quot;]</code> is the field filter, that selects the specified field name on the current value if it is an object. If the current value is not an object, then nothing is selected.</li>
        </ul>
        <ul>
          <li><code>.[idx]</code> is the array element filter, that selects the value at the specified index in the current value if it is an array. If the current value is not an array, then nothing is selected.</li>
        </ul>
        <ul>
          <li><code>.[idx1:idx1]</code>, <code>.[idx:]</code>, <code>.[:idx]</code> is the array slice filter, that selects only elements within the provided lower bound (inclusive) and upper bound (exclusive) on the current value if it is an array. If the lower bound is not specified, then the slice is from the beginning of the array, up to the upper bound (exclusive). If the upper bound is not specified, then the slice starts from the lower bound (inclusive), up to the end of the array. Negative indices are not supported. If the current value is not an array, then nothing is selected.</li>
        </ul>
        <ul>
          <li><code>..</code> is the recursive descent filter.</li>
        </ul>
        <ul>
          <li><code>.[]</code> is the iterator filter, that selects every element on the current value if it is an object or an array. If the input is neither an object nor an array, then nothing is selected.</li>
        </ul>
        <p>Filters can be sequenced by using the pipe (<code>|</code>) symbol as separator, for instance to select the field <code>a</code> and then only the third element in <code>a</code> if it is an array, the filter is <code>.a | .[2]</code>.
        The pipe separator can be elided in many cases, and the leading dot that would follow it is then removed. For instance, the previous example can also be written <code>.a[2]</code>.</p>
        <div class="callout warning">
          <i class="icofont-laika warning">&#xf026;</i>
          <p>The recursive descent operator must be preceded by a pipe if it is not the first operator.</p>
        </div>
        
        <h3 id="the-constructors" class="section"><a class="anchor-link left" href="#the-constructors"><i class="icofont-laika link">&#xef71;</i></a>The constructors</h3>
        
        <h3 id="values" class="section"><a class="anchor-link left" href="#values"><i class="icofont-laika link">&#xef71;</i></a>Values</h3>
        <p>Any JSON scalar value is a valid query constructor, it means:</p>
        <ul>
          <li><code>null</code></li>
        </ul>
        <ul>
          <li><code>&quot;some string&quot;</code></li>
        </ul>
        <ul>
          <li><code>12</code>, <code>0.1</code></li>
        </ul>
        <ul>
          <li><code>true</code>, <code>false</code></li>
        </ul>
        <p>build the equivalent JSON value. The scalar values do not depend on the selected values from the input.</p>
        
        <h4 id="objects" class="section"><a class="anchor-link left" href="#objects"><i class="icofont-laika link">&#xef71;</i></a>Objects</h4>
        <p>It is possible to build a JSON object, whose field values may depend on the selected elements from the filter phase, by using the following syntax: <code>{ &quot;a&quot;: query1, &quot;b&quot;: query2, ... }</code>.</p>
        <p>Each object value is a full query. If a query emits several elements (e.g. is an iterator), then one object is emitted to the output per element the iterator filter selects.</p>
        <div class="callout warning">
          <i class="icofont-laika warning">&#xf026;</i>
          <p>The object constructor can only contain one top-level iterator query. For instance, trying to compile the following query will <strong>fail</strong>:</p>
          <pre><code>{ &quot;a&quot;: .a[], &quot;b&quot;: .b[] }</code></pre>
        </div>
        
        <h4 id="arrays" class="section"><a class="anchor-link left" href="#arrays"><i class="icofont-laika link">&#xef71;</i></a>Arrays</h4>
        <p>It is possible to build a JSON array, whose element values may depend on the selected elements from the filter phase, by using the following syntax: <code>[ query1, query2, ... ]</code>.</p>
        <p>Each value is a full query. If a query emits several elements (e.g. is an iterator), then all resulting elements are emitted as array elements, in the order they are selected.</p>
        
        <h2 id="using-queries" class="section"><a class="anchor-link left" href="#using-queries"><i class="icofont-laika link">&#xef71;</i></a>Using queries</h2>
        <p>A query must first be compiled to be usable. Compiling a query can be a quite expensive computation, but a compiled query can be reused any number of time, so you usually will compile it only once.</p>
        <p>To use a query, make your stream pass though the compiled query obtained above. A compiled query is a <code>Pipe[F, Token, Token]</code>.</p>
        <pre><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">qCompiler</span><span> = </span><span class="identifier">jq</span><span>.</span><span class="type-name">Compiler</span><span>[</span><span class="type-name">SyncIO</span><span>]
</span><span class="comment">// qCompiler: jq.Compiler[SyncIO] = fs2.data.json.jq.internal.ESPJqCompiler@4f9a3aeb
</span><span>
</span><span class="keyword">val</span><span> </span><span class="identifier">compiled</span><span> = </span><span class="identifier">qCompiler</span><span>.</span><span class="identifier">compile</span><span>(</span><span class="identifier">query</span><span>).</span><span class="identifier">unsafeRunSync</span><span>()
</span><span class="comment">// compiled: Pipe[SyncIO, Token, Token] = &lt;function1&gt;
</span><span>
</span><span class="identifier">stream</span><span>
  .</span><span class="identifier">through</span><span>(</span><span class="identifier">compiled</span><span>)
  .</span><span class="identifier">compile</span><span>
  .</span><span class="identifier">to</span><span>(</span><span class="identifier">collector</span><span>.</span><span class="identifier">pretty</span><span>())
  .</span><span class="identifier">unsafeRunSync</span><span>()
</span><span class="comment">// res0: String = &quot;&quot;&quot;[
//   {
//     &quot;field2&quot;: &quot;test&quot;,
//     &quot;field3&quot;: 1
//   },
//   {
//     &quot;field2&quot;: &quot;test&quot;,
//     &quot;field3&quot;: 2
//   },
//   {
//     &quot;field2&quot;: &quot;test&quot;,
//     &quot;field3&quot;: 3
//   }
// ]&quot;&quot;&quot;</span></code></pre>

        
<hr class="footer-rule"/>
<footer>
  <code>fs2-data</code> is a <a href="https://typelevel.org/">Typelevel</a> affiliate project distributed under the <a href="https://www.apache.org/licenses/LICENSE-2.0.txt">Apache-2.0</a> license.
</footer>


      </main>

    </div>

  </body>

</html>