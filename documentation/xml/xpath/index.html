<!DOCTYPE html>
<html lang="en">
  
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Typelevel Laika + Helium Theme" />
  <title>XPath</title>
  
  <meta name="author" content="Lucas Satabin"/>
  
  <meta name="author" content="Yannick Heiber"/>
  
  
  <meta name="description" content="site"/>
  
  
  
  <link rel="icon" sizes="32x32" type="image/png" href="https://typelevel.org/img/favicon.png"/>
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700">
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:500">
  
  <link rel="stylesheet" type="text/css" href="/pagefind/pagefind-ui.css" />
    <link rel="stylesheet" type="text/css" href="../../../helium/site/icofont.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../helium/site/laika-helium.css" />
  <script src="/pagefind/pagefind-ui.js"></script>
    <script src="../../../helium/site/laika-helium.js"></script>
  
  
  <script> /* for avoiding page load transitions */ </script>
</head>

  <body>

    <header id="top-bar" class="light-default dark-default">

  <div class="row">
    <a id="nav-icon">
      <i class="icofont-laika navigationMenu" title="Navigation">&#xefa2;</i>
    </a>
    
    
  </div>

  <a class="image-link" href="../../../"><img src="../../../media/logo-header.svg"></a>

  <div class="row links">
    
    <a class="icon-link svg-link" href="https://www.javadoc.io/doc/org.gnieh/fs2-data-docs_2.13/1.12.0/fs2/data/index.html"><span class="api" title="API"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M75,47.5c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm-50,-0c13.246,-0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,-0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm2.705,16.735l7.239,0l0.622,-4.904l-21.833,0l-0,4.904l7.589,0l0,22.067l6.383,0l-0,-22.067Zm58.076,7.265c-0,-8.757 -3.698,-14.166 -10.781,-14.166c-7.083,-0 -10.781,5.604 -10.781,14.166c0,8.757 3.698,14.166 10.781,14.166c7.083,0 10.781,-5.604 10.781,-14.166Zm-6.539,0c0,6.538 -1.128,9.496 -4.242,9.496c-2.997,0 -4.242,-2.88 -4.242,-9.496c-0,-6.616 1.206,-9.496 4.242,-9.496c3.036,-0 4.242,2.88 4.242,9.496Zm-29.242,-67c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm0.512,9.834c-7.122,-0 -12.609,5.098 -12.609,14.127c-0,9.263 5.215,14.205 12.532,14.205c4.164,0 7.083,-1.634 9.068,-3.658l-2.88,-3.697c-1.518,1.206 -3.153,2.413 -5.838,2.413c-3.697,-0 -6.266,-2.763 -6.266,-9.263c-0,-6.616 2.724,-9.379 6.149,-9.379c2.102,-0 3.892,0.778 5.371,1.984l3.113,-3.775c-2.257,-1.868 -4.748,-2.957 -8.64,-2.957Z"/>
  </g>
</svg></span></a>
    
    <a class="icon-link svg-link" href="https://github.com/gnieh/fs2-data"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
    <a class="icon-link glyph-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika chat" title="Chat">&#xeed5;</i></a>
    
    <a class="icon-link svg-link" href="https://piaille.fr/@lucassatabin"><span class="mastodon" title="Mastodon"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <g class="svg-shape">
    <path d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a3.614 3.614 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522c0-.859.22-1.541.66-2.046.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764.442.505.661 1.187.661 2.046v4.203z"/>
  </g>
</svg></span></a>
    
  </div>  

</header>
    
    <nav id="sidebar">

  <div class="row">
    
    <a class="icon-link svg-link" href="https://www.javadoc.io/doc/org.gnieh/fs2-data-docs_2.13/1.12.0/fs2/data/index.html"><span class="api" title="API"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M75,47.5c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm-50,-0c13.246,-0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,-0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm2.705,16.735l7.239,0l0.622,-4.904l-21.833,0l-0,4.904l7.589,0l0,22.067l6.383,0l-0,-22.067Zm58.076,7.265c-0,-8.757 -3.698,-14.166 -10.781,-14.166c-7.083,-0 -10.781,5.604 -10.781,14.166c0,8.757 3.698,14.166 10.781,14.166c7.083,0 10.781,-5.604 10.781,-14.166Zm-6.539,0c0,6.538 -1.128,9.496 -4.242,9.496c-2.997,0 -4.242,-2.88 -4.242,-9.496c-0,-6.616 1.206,-9.496 4.242,-9.496c3.036,-0 4.242,2.88 4.242,9.496Zm-29.242,-67c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm0.512,9.834c-7.122,-0 -12.609,5.098 -12.609,14.127c-0,9.263 5.215,14.205 12.532,14.205c4.164,0 7.083,-1.634 9.068,-3.658l-2.88,-3.697c-1.518,1.206 -3.153,2.413 -5.838,2.413c-3.697,-0 -6.266,-2.763 -6.266,-9.263c-0,-6.616 2.724,-9.379 6.149,-9.379c2.102,-0 3.892,0.778 5.371,1.984l3.113,-3.775c-2.257,-1.868 -4.748,-2.957 -8.64,-2.957Z"/>
  </g>
</svg></span></a>
    
    <a class="icon-link svg-link" href="https://github.com/gnieh/fs2-data"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
    <a class="icon-link glyph-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika chat" title="Chat">&#xeed5;</i></a>
    
    <a class="icon-link svg-link" href="https://piaille.fr/@lucassatabin"><span class="mastodon" title="Mastodon"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <g class="svg-shape">
    <path d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a3.614 3.614 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522c0-.859.22-1.541.66-2.046.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764.442.505.661 1.187.661 2.046v4.203z"/>
  </g>
</svg></span></a>
    
  </div>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="../../../">Home</a></li>
    <li class="level1 nav-header">documentation</li>
    <li class="level2 nav-leaf"><a href="../../">Introduction</a></li>
    <li class="level2 nav-header">csv</li>
    <li class="level3 nav-leaf"><a href="../../csv/">Introduction</a></li>
    <li class="level3 nav-leaf"><a href="../../csv/generic/">Generic</a></li>
    <li class="level2 nav-header">json</li>
    <li class="level3 nav-leaf"><a href="../../json/">Introduction</a></li>
    <li class="level3 nav-leaf"><a href="../../json/jsonpath/">JSONPath</a></li>
    <li class="level3 nav-leaf"><a href="../../json/jq/">JSON Queries</a></li>
    <li class="level3 nav-leaf"><a href="../../json/libraries/">JSON Libraries</a></li>
    <li class="level3 nav-leaf"><a href="../../json/jsonpatch/">JSON Patch</a></li>
    <li class="level3 nav-leaf"><a href="../../json/transformations/">Transformations</a></li>
    <li class="level2 nav-header">xml</li>
    <li class="level3 nav-leaf"><a href="../">Introduction</a></li>
    <li class="level3 active nav-leaf"><a href="#">XPath</a></li>
    <li class="level3 nav-leaf"><a href="../libraries/">XML Libraries</a></li>
    <li class="level2 nav-header">cbor</li>
    <li class="level3 nav-leaf"><a href="../../cbor/">Introduction</a></li>
    <li class="level2 nav-header">cbor-json</li>
    <li class="level3 nav-leaf"><a href="../../cbor-json/">Introduction</a></li>
    <li class="level1 nav-header">cookbooks</li>
    <li class="level2 nav-leaf"><a href="../../../cookbooks/jq/">Reading/transforming/writing JSON data</a></li>
    <li class="level2 nav-leaf"><a href="../../../cookbooks/jsonlines/">Handling JSON Lines data</a></li>
  </ul>

  <ul class="nav-list">
    <li><div id="search"></div></li>
  </ul>

</nav>

<script>
window.addEventListener('DOMContentLoaded', (event) => {
  new PagefindUI({ element: "#search", showSubResults: true, showImages: false });
});
</script>


    <div id="container">

      
<nav id="page-nav">
  <p class="header"><a href="#">XPath</a></p>

  <ul class="nav-list">
    <li class="level1 nav-node"><a href="#building-an-xpath">Building an XPath</a></li>
    <li class="level2 nav-leaf"><a href="#parsing-a-string-using-the-xpath-parser">Parsing a string using the XPath parser</a></li>
    <li class="level2 nav-leaf"><a href="#the-subset">The subset</a></li>
    <li class="level1 nav-leaf"><a href="#using-xpath">Using XPath</a></li>
  </ul>

  <p class="footer"></p>
</nav>


      <main class="content">

        <h1 id="xpath" class="title">XPath</h1>
        <p>Module: <a href="https://mvnrepository.com/artifact/org.gnieh/fs2-data-xml_2.13"><img src="https://img.shields.io/maven-central/v/org.gnieh/fs2-data-xml_2.13.svg" alt="Maven Central"></a></p>
        <p>The <code>fs2-data-xml</code> module provides a streaming implementation of XPath.</p>
        <p>Let&#39;s use the following XML input as an example.</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">syntax</span><span>.</span><span class="identifier">all</span><span>.</span><span class="identifier">_</span><span>

</span><span class="keyword">import</span><span> </span><span class="identifier">fs2</span><span>.</span><span class="identifier">_</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">fs2</span><span>.</span><span class="identifier">data</span><span>.</span><span class="identifier">xml</span><span>.</span><span class="identifier">_</span><span>

</span><span class="keyword">val</span><span> </span><span class="identifier">stream</span><span> = </span><span class="string-literal">xml&quot;&quot;&quot;
&lt;root&gt;
  &lt;a attr=&quot;value&quot;&gt;
    &lt;b&gt;text&lt;/b&gt;
    &lt;a&gt;
      &lt;c&gt;&lt;![CDATA[some other text]]&gt;&lt;/c&gt;
    &lt;/a&gt;
  &lt;/a&gt;
&lt;/root&gt;
&quot;&quot;&quot;</span><span>
</span><span class="comment">// stream: Stream[Fallible, XmlEvent] = Stream(..)</span></code></pre>
        
        <h2 id="building-an-xpath" class="section"><a class="anchor-link left" href="#building-an-xpath"><i class="icofont-laika link">&#xef71;</i></a>Building an XPath</h2>
        <p>A subset of <a href="https://www.w3.org/TR/xpath/">XPath</a> can be used to select a subset of a XML event stream. There are several ways to create selectors:</p>
        <ul>
          <li>build the selector using the constructors, which can be quite verbose and cumbersome;</li>
        </ul>
        <ul>
          <li>parse a string with the XPath parser;</li>
        </ul>
        <ul>
          <li>use the <code>xpath</code> interpolator.</li>
        </ul>
        
        <h3 id="parsing-a-string-using-the-xpath-parser" class="section"><a class="anchor-link left" href="#parsing-a-string-using-the-xpath-parser"><i class="icofont-laika link">&#xef71;</i></a>Parsing a string using the XPath parser</h3>
        <p>For instance, to select and enumerate <code>a</code> elements, you can create this selector. Only the events describing the <code>a</code> elements will be emitted as a result.</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">fs2</span><span>.</span><span class="identifier">data</span><span>.</span><span class="identifier">xml</span><span>.</span><span class="identifier">xpath</span><span>.</span><span class="identifier">_</span><span>

</span><span class="keyword">val</span><span> </span><span class="identifier">selector</span><span> = </span><span class="type-name">XPathParser</span><span>.</span><span class="identifier">either</span><span>(</span><span class="string-literal">&quot;//a&quot;</span><span>)
</span><span class="comment">// selector: Either[Throwable, XPath] = Right(
//   value = XPath(
//     locations = NonEmptyList(
//       head = List(
//         Location(
//           axis = Descendant,
//           node = Node(prefix = None, local = Some(value = &quot;a&quot;)),
//           predicate = None
//         )
//       ),
//       tail = List()
//     )
//   )
// )</span></code></pre>
        <p>The XPath parser wraps the result in anything that has an <a href="https://typelevel.org/cats/api/cats/MonadError.html"><code>MonadError</code> with error type <code>Throwable</code></a> to catch potential parsing errors. If you prefer not to have this wrapping, you can use the <code>xpath</code> interpolator.</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">fs2</span><span>.</span><span class="identifier">data</span><span>.</span><span class="identifier">xml</span><span>.</span><span class="identifier">xpath</span><span>.</span><span class="identifier">literals</span><span>.</span><span class="identifier">_</span><span>

</span><span class="keyword">val</span><span> </span><span class="identifier">path</span><span> = </span><span class="string-literal">xpath&quot;//a&quot;</span><span>
</span><span class="comment">// path: XPath = XPath(
//   locations = NonEmptyList(
//     head = List(
//       Location(
//         axis = Descendant,
//         node = Node(prefix = None, local = Some(value = &quot;a&quot;)),
//         predicate = None
//       )
//     ),
//     tail = List()
//   )
// )</span></code></pre>
        <p>The advantage of the interpolator is that potential syntax errors are checked at compilation time.</p>
        
        <h3 id="the-subset" class="section"><a class="anchor-link left" href="#the-subset"><i class="icofont-laika link">&#xef71;</i></a>The subset</h3>
        <p>The supported XPath features are:</p>
        <ul>
          <li>
            <code>/</code> the child axis
            <ul>
              <li><code>/a</code> selects all <code>a</code> children</li>
              <li><code>/*</code> selects all children elements</li>
            </ul>
          </li>
        </ul>
        <ul>
          <li>
            <code>//</code> The descendant axis
            <ul>
              <li><code>//a</code> selects all <code>a</code> descendants</li>
              <li><code>//*</code> selects all descendant elements</li>
            </ul>
          </li>
        </ul>
        <ul>
          <li>
            <code>[&lt;attribute selection expression&gt;]</code> attribute predicate selection
            <ul>
              <li><code>@attr</code> attribute <code>attr</code> exists</li>
              <li><code>@attr == &quot;value&quot;</code> attribute <code>attr</code> equals <code>value</code></li>
              <li><code>@attr != &quot;value&quot;</code> attribute <code>attr</code> does not equal <code>value</code></li>
              <li><code>p1 &amp;&amp; p2</code> element attributes match both <code>p1</code> and <code>p2</code></li>
              <li><code>p1 || p2</code> element attributes match either <code>p1</code> or <code>p2</code></li>
              <li><code>!p</code> element attributes do not match <code>p</code></li>
            </ul>
          </li>
        </ul>
        <ul>
          <li><code>xp1|xp2</code> matches the XPath expression <code>xp1</code> or <code>xp2</code></li>
        </ul>
        <p>Operator precedence is the common one: <code>!</code> has precedence over <code>&amp;&amp;</code> which has precedence over <code>||</code>. This means that <code>!p1 &amp;&amp; p2 || p3</code> is the same as <code>((!p1) &amp;&amp; p2) || p3</code>.
        You can use parentheses to associate differently, for instance <code>!(p1 &amp;&amp; p2) || p3</code>.</p>
        
        <h2 id="using-xpath" class="section"><a class="anchor-link left" href="#using-xpath"><i class="icofont-laika link">&#xef71;</i></a>Using XPath</h2>
        <p>Using the path defined above, we can filter the stream of events, to only emit selected tokens downstream. This can be used to drastically reduce the amount of emitted data, to only the parts that are of interest for you.
        The filtering pipes are located in the <code>fs2.data.xml.xpath.filter</code> namespace.</p>
        <p>The main operators in the namespace are:</p>
        <ul>
          <li><code>filter.first(xpath)</code> which is a <code>Pipe</code> returning the events of the first match only.</li>
        </ul>
        <ul>
          <li><code>filter.collect(xpath, collector)</code> which uses the provided <code>collector</code> to aggregate the events of each match, and emits all the aggregated results.</li>
        </ul>
        <ul>
          <li><code>filter.dom[Node](xpath)</code> which builds the DOM for each match for any DOM type <code>Node</code> with a <a href="../#dom-builder-and-eventifier"><code>DocumentBuilder</code></a> in scope.</li>
        </ul>
        <ul>
          <li><code>filter.consumer(xpath, consumer)</code> which sends all matches as a stream through the provided <code>consumer</code>.</li>
        </ul>
        <ul>
          <li><code>filter.through(xpath, pipe)</code> which sends all matches as a stream through the provided <code>pipe</code>.</li>
        </ul>
        <div class="callout info">
          <i class="icofont-laika info">&#xef4e;</i>
          <p>Since XPath includes a recursive descent operator, there can be nested matches for your xpath.
          The matches are returned in the order their opening matching element is encountered in the input by default.
          This means that for nested matches, the first stream returned is the ancestor element.</p>
        </div>
        <p>Using <code>filter.collect</code>, you can build a stream that collects each match for the provided collector and emits the aggregated result. For instance, to build the list of string representations of the matches, you can run the following code.</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">effect</span><span>.</span><span class="identifier">_</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">effect</span><span>.</span><span class="identifier">unsafe</span><span>.</span><span class="identifier">implicits</span><span>.</span><span class="identifier">global</span><span>

</span><span class="identifier">stream</span><span>
  .</span><span class="identifier">lift</span><span>[</span><span class="type-name">IO</span><span>]
  .</span><span class="identifier">through</span><span>(</span><span class="identifier">filter</span><span>.</span><span class="identifier">collect</span><span>(</span><span class="identifier">path</span><span>, </span><span class="identifier">collector</span><span>.</span><span class="identifier">raw</span><span>()))
  .</span><span class="identifier">compile</span><span>
  .</span><span class="identifier">toList</span><span>
  .</span><span class="identifier">unsafeRunSync</span><span>()
</span><span class="comment">// res0: List[String] = List(
//   &quot;&quot;&quot;&lt;a attr=&quot;value&quot;&gt;
//     &lt;b&gt;text&lt;/b&gt;
//     &lt;a&gt;
//       &lt;c&gt;&lt;![CDATA[some other text]]&gt;&lt;/c&gt;
//     &lt;/a&gt;
//   &lt;/a&gt;&quot;&quot;&quot;,
//   &quot;&quot;&quot;&lt;a&gt;
//       &lt;c&gt;&lt;![CDATA[some other text]]&gt;&lt;/c&gt;
//     &lt;/a&gt;&quot;&quot;&quot;
// )</span></code></pre>
        <p>If you want to have results emitted as early as possible instead of in order, you can set the <code>deterministic</code> parameter to <code>false</code>.</p>
        <pre><code class="nohighlight"><span class="identifier">stream</span><span>
  .</span><span class="identifier">lift</span><span>[</span><span class="type-name">IO</span><span>]
  .</span><span class="identifier">through</span><span>(</span><span class="identifier">filter</span><span>.</span><span class="identifier">collect</span><span>(</span><span class="identifier">path</span><span>, </span><span class="identifier">collector</span><span>.</span><span class="identifier">raw</span><span>(), </span><span class="identifier">deterministic</span><span> = </span><span class="boolean-literal">false</span><span>))
  .</span><span class="identifier">compile</span><span>
  .</span><span class="identifier">toList</span><span>
  .</span><span class="identifier">unsafeRunSync</span><span>()
</span><span class="comment">// res1: List[String] = List(
//   &quot;&quot;&quot;&lt;a&gt;
//       &lt;c&gt;&lt;![CDATA[some other text]]&gt;&lt;/c&gt;
//     &lt;/a&gt;&quot;&quot;&quot;,
//   &quot;&quot;&quot;&lt;a attr=&quot;value&quot;&gt;
//     &lt;b&gt;text&lt;/b&gt;
//     &lt;a&gt;
//       &lt;c&gt;&lt;![CDATA[some other text]]&gt;&lt;/c&gt;
//     &lt;/a&gt;
//   &lt;/a&gt;&quot;&quot;&quot;
// )</span></code></pre>
        <p>The <code>filter.consumer</code> operator allows for handling each match in a streaming fashion without emitting any value.
        For instance, let&#39;s say you want to save each match in a file, incrementing a counter on each match. You can run the following code.</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">fs2</span><span>.</span><span class="identifier">io</span><span>.</span><span class="identifier">file</span><span>.{</span><span class="type-name">Files</span><span>, </span><span class="type-name">Path</span><span>}

</span><span class="keyword">def</span><span> </span><span class="declaration-name">saveXml</span><span>(</span><span class="identifier">counter</span><span>: </span><span class="type-name">Ref</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">Int</span><span>], </span><span class="identifier">events</span><span>: </span><span class="type-name">Stream</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">XmlEvent</span><span>]): </span><span class="type-name">Stream</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">Nothing</span><span>] =
  </span><span class="type-name">Stream</span><span>.</span><span class="identifier">eval</span><span>(</span><span class="identifier">counter</span><span>.</span><span class="identifier">getAndUpdate</span><span>(</span><span class="identifier">_</span><span> + </span><span class="number-literal">1</span><span>)).</span><span class="identifier">flatMap</span><span> { </span><span class="identifier">index</span><span> =&gt;
    </span><span class="identifier">events</span><span>
      .</span><span class="identifier">through</span><span>(</span><span class="identifier">render</span><span>.</span><span class="identifier">raw</span><span>())
      .</span><span class="identifier">through</span><span>(</span><span class="type-name">Files</span><span>[</span><span class="type-name">IO</span><span>].</span><span class="identifier">writeUtf8</span><span>(</span><span class="type-name">Path</span><span>(</span><span class="string-literal">s&quot;match-</span><span class="substitution">$index</span><span class="string-literal">.xml&quot;</span><span>)))
  }

</span><span class="keyword">val</span><span> </span><span class="identifier">program</span><span> =
  </span><span class="keyword">for</span><span> {
    </span><span class="identifier">counter</span><span> &lt;- </span><span class="type-name">Ref</span><span>[</span><span class="type-name">IO</span><span>].</span><span class="identifier">of</span><span>(</span><span class="number-literal">0</span><span>)
    </span><span class="identifier">_</span><span> &lt;- </span><span class="identifier">stream</span><span>
      .</span><span class="identifier">lift</span><span>[</span><span class="type-name">IO</span><span>]
      .</span><span class="identifier">through</span><span>(</span><span class="identifier">filter</span><span>.</span><span class="identifier">consume</span><span>(</span><span class="identifier">path</span><span>, </span><span class="identifier">saveXml</span><span>(</span><span class="identifier">counter</span><span>, </span><span class="identifier">_</span><span>)))
      .</span><span class="identifier">compile</span><span>
      .</span><span class="identifier">drain</span><span>
  } </span><span class="keyword">yield</span><span> ()
</span><span class="comment">// program: IO[Unit] = FlatMap(
//   ioe = Delay(
//     thunk = cats.effect.IO$$$Lambda$11876/0x0000000803057840@6520118d,
//     event = cats.effect.tracing.TracingEvent$StackTrace
//   ),
//   f = &lt;function1&gt;,
//   event = cats.effect.tracing.TracingEvent$StackTrace
// )
</span><span>
</span><span class="identifier">program</span><span>.</span><span class="identifier">unsafeRunSync</span><span>()

</span><span class="type-name">Files</span><span>[</span><span class="type-name">IO</span><span>].</span><span class="identifier">readUtf8</span><span>(</span><span class="type-name">Path</span><span>(</span><span class="string-literal">&quot;match-0.xml&quot;</span><span>)).</span><span class="identifier">compile</span><span>.</span><span class="identifier">string</span><span>.</span><span class="identifier">unsafeRunSync</span><span>()
</span><span class="comment">// res3: String = &quot;&quot;&quot;&lt;a attr=&quot;value&quot;&gt;
//     &lt;b&gt;text&lt;/b&gt;
//     &lt;a&gt;
//       &lt;c&gt;&lt;![CDATA[some other text]]&gt;&lt;/c&gt;
//     &lt;/a&gt;
//   &lt;/a&gt;&quot;&quot;&quot;
</span><span class="type-name">Files</span><span>[</span><span class="type-name">IO</span><span>].</span><span class="identifier">readUtf8</span><span>(</span><span class="type-name">Path</span><span>(</span><span class="string-literal">&quot;match-1.xml&quot;</span><span>)).</span><span class="identifier">compile</span><span>.</span><span class="identifier">string</span><span>.</span><span class="identifier">unsafeRunSync</span><span>()
</span><span class="comment">// res4: String = &quot;&quot;&quot;&lt;a&gt;
//       &lt;c&gt;&lt;![CDATA[some other text]]&gt;&lt;/c&gt;
//     &lt;/a&gt;&quot;&quot;&quot;</span></code></pre>
        <div class="callout warning">
          <i class="icofont-laika warning">&#xf026;</i>
          <p>The operator described below is unsafe and should be used carefully only if none of the above operators fits your purpose.
          When using it, please ensure that you:</p>
          <ul>
            <li>consume <strong>all</strong> inner <code>Stream</code>s</li>
          </ul>
          <ul>
            <li>consume them in <strong>parallel</strong> (e.g. with a variant of <code>parEvalMap</code> and paralellism &gt;1, or with a variant of <code>parJoin</code>).</li>
          </ul>
          <p>Failure to do so might result in memory leaks or hanging programs.</p>
        </div>
        <p>The <code>filter.unsafeRaw</code> operator emits a stream of all matches.
        Each match is represented as a nested stream of XML events which must be consumed.</p>
        <pre><code class="nohighlight"><span class="identifier">stream</span><span>
  .</span><span class="identifier">lift</span><span>[</span><span class="type-name">IO</span><span>]
  .</span><span class="identifier">through</span><span>(</span><span class="identifier">filter</span><span>.</span><span class="identifier">unsafeRaw</span><span>(</span><span class="identifier">path</span><span>))
  .</span><span class="identifier">parEvalMapUnbounded</span><span>(</span><span class="identifier">_</span><span>.</span><span class="identifier">through</span><span>(</span><span class="identifier">render</span><span>.</span><span class="identifier">raw</span><span>()).</span><span class="identifier">compile</span><span>.</span><span class="identifier">foldMonoid</span><span>)
  .</span><span class="identifier">compile</span><span>
  .</span><span class="identifier">toList</span><span>
  .</span><span class="identifier">unsafeRunSync</span><span>()
</span><span class="comment">// res5: List[String] = List(
//   &quot;&quot;&quot;&lt;a attr=&quot;value&quot;&gt;
//     &lt;b&gt;text&lt;/b&gt;
//     &lt;a&gt;
//       &lt;c&gt;&lt;![CDATA[some other text]]&gt;&lt;/c&gt;
//     &lt;/a&gt;
//   &lt;/a&gt;&quot;&quot;&quot;,
//   &quot;&quot;&quot;&lt;a&gt;
//       &lt;c&gt;&lt;![CDATA[some other text]]&gt;&lt;/c&gt;
//     &lt;/a&gt;&quot;&quot;&quot;
// )</span></code></pre>

        
<hr class="footer-rule"/>
<footer>
  <code>fs2-data</code> is a <a href="https://typelevel.org/">Typelevel</a> affiliate project distributed under the <a href="https://www.apache.org/licenses/LICENSE-2.0.txt">Apache-2.0</a> license.
</footer>


      </main>

    </div>

  </body>

</html>