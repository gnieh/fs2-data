<!DOCTYPE html>
<html lang="en">
  
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Typelevel Laika + Helium Theme" />
  <title>Introduction</title>
  
  <meta name="author" content="Lucas Satabin"/>
  
  <meta name="author" content="Yannick Heiber"/>
  
  
  <meta name="description" content="site"/>
  
  
  
  <link rel="icon" sizes="32x32" type="image/png" href="https://typelevel.org/img/favicon.png"/>
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700">
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:500">
  
  <link rel="stylesheet" type="text/css" href="/pagefind/pagefind-ui.css" />
    <link rel="stylesheet" type="text/css" href="../../helium/site/icofont.min.css" />
    <link rel="stylesheet" type="text/css" href="../../helium/site/laika-helium.css" />
  <script src="/pagefind/pagefind-ui.js"></script>
    <script src="../../helium/site/laika-helium.js"></script>
  
  
  <script> /* for avoiding page load transitions */ </script>
</head>

  <body>

    <header id="top-bar" class="light-default dark-default">

  <div class="row">
    <a id="nav-icon">
      <i class="icofont-laika navigationMenu" title="Navigation">&#xefa2;</i>
    </a>
    
    
  </div>

  <a class="image-link" href="../../"><img src="../../media/logo-header.svg"></a>

  <div class="row links">
    
    <a class="icon-link svg-link" href="https://www.javadoc.io/doc/org.gnieh/fs2-data-docs_2.13/1.11.0/fs2/data/index.html"><span class="api" title="API"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M75,47.5c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm-50,-0c13.246,-0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,-0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm2.705,16.735l7.239,0l0.622,-4.904l-21.833,0l-0,4.904l7.589,0l0,22.067l6.383,0l-0,-22.067Zm58.076,7.265c-0,-8.757 -3.698,-14.166 -10.781,-14.166c-7.083,-0 -10.781,5.604 -10.781,14.166c0,8.757 3.698,14.166 10.781,14.166c7.083,0 10.781,-5.604 10.781,-14.166Zm-6.539,0c0,6.538 -1.128,9.496 -4.242,9.496c-2.997,0 -4.242,-2.88 -4.242,-9.496c-0,-6.616 1.206,-9.496 4.242,-9.496c3.036,-0 4.242,2.88 4.242,9.496Zm-29.242,-67c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm0.512,9.834c-7.122,-0 -12.609,5.098 -12.609,14.127c-0,9.263 5.215,14.205 12.532,14.205c4.164,0 7.083,-1.634 9.068,-3.658l-2.88,-3.697c-1.518,1.206 -3.153,2.413 -5.838,2.413c-3.697,-0 -6.266,-2.763 -6.266,-9.263c-0,-6.616 2.724,-9.379 6.149,-9.379c2.102,-0 3.892,0.778 5.371,1.984l3.113,-3.775c-2.257,-1.868 -4.748,-2.957 -8.64,-2.957Z"/>
  </g>
</svg></span></a>
    
    <a class="icon-link svg-link" href="https://github.com/gnieh/fs2-data"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
    <a class="icon-link glyph-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika chat" title="Chat">&#xeed5;</i></a>
    
    <a class="icon-link svg-link" href="https://fosstodon.org/@lucassatabin"><span class="mastodon" title="Mastodon"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <g class="svg-shape">
    <path d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a3.614 3.614 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522c0-.859.22-1.541.66-2.046.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764.442.505.661 1.187.661 2.046v4.203z"/>
  </g>
</svg></span></a>
    
  </div>  

</header>
    
    <nav id="sidebar">

  <div class="row">
    
    <a class="icon-link svg-link" href="https://www.javadoc.io/doc/org.gnieh/fs2-data-docs_2.13/1.11.0/fs2/data/index.html"><span class="api" title="API"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M75,47.5c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm-50,-0c13.246,-0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,-0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm2.705,16.735l7.239,0l0.622,-4.904l-21.833,0l-0,4.904l7.589,0l0,22.067l6.383,0l-0,-22.067Zm58.076,7.265c-0,-8.757 -3.698,-14.166 -10.781,-14.166c-7.083,-0 -10.781,5.604 -10.781,14.166c0,8.757 3.698,14.166 10.781,14.166c7.083,0 10.781,-5.604 10.781,-14.166Zm-6.539,0c0,6.538 -1.128,9.496 -4.242,9.496c-2.997,0 -4.242,-2.88 -4.242,-9.496c-0,-6.616 1.206,-9.496 4.242,-9.496c3.036,-0 4.242,2.88 4.242,9.496Zm-29.242,-67c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm0.512,9.834c-7.122,-0 -12.609,5.098 -12.609,14.127c-0,9.263 5.215,14.205 12.532,14.205c4.164,0 7.083,-1.634 9.068,-3.658l-2.88,-3.697c-1.518,1.206 -3.153,2.413 -5.838,2.413c-3.697,-0 -6.266,-2.763 -6.266,-9.263c-0,-6.616 2.724,-9.379 6.149,-9.379c2.102,-0 3.892,0.778 5.371,1.984l3.113,-3.775c-2.257,-1.868 -4.748,-2.957 -8.64,-2.957Z"/>
  </g>
</svg></span></a>
    
    <a class="icon-link svg-link" href="https://github.com/gnieh/fs2-data"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
    <a class="icon-link glyph-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika chat" title="Chat">&#xeed5;</i></a>
    
    <a class="icon-link svg-link" href="https://fosstodon.org/@lucassatabin"><span class="mastodon" title="Mastodon"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <g class="svg-shape">
    <path d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a3.614 3.614 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522c0-.859.22-1.541.66-2.046.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764.442.505.661 1.187.661 2.046v4.203z"/>
  </g>
</svg></span></a>
    
  </div>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="../../">Home</a></li>
    <li class="level1 nav-header">documentation</li>
    <li class="level2 nav-leaf"><a href="../">Introduction</a></li>
    <li class="level2 nav-header">csv</li>
    <li class="level3 nav-leaf"><a href="../csv/">Introduction</a></li>
    <li class="level3 nav-leaf"><a href="../csv/generic/">Generic</a></li>
    <li class="level2 nav-header">json</li>
    <li class="level3 nav-leaf"><a href="../json/">Introduction</a></li>
    <li class="level3 nav-leaf"><a href="../json/jsonpath/">JSONPath</a></li>
    <li class="level3 nav-leaf"><a href="../json/jq/">JSON Queries</a></li>
    <li class="level3 nav-leaf"><a href="../json/libraries/">JSON Libraries</a></li>
    <li class="level3 nav-leaf"><a href="../json/jsonpatch/">JSON Patch</a></li>
    <li class="level3 nav-leaf"><a href="../json/transformations/">Transformations</a></li>
    <li class="level2 nav-header">xml</li>
    <li class="level3 active nav-leaf"><a href="#">Introduction</a></li>
    <li class="level3 nav-leaf"><a href="xpath/">XPath</a></li>
    <li class="level3 nav-leaf"><a href="libraries/">XML Libraries</a></li>
    <li class="level2 nav-header">cbor</li>
    <li class="level3 nav-leaf"><a href="../cbor/">Introduction</a></li>
    <li class="level2 nav-header">cbor-json</li>
    <li class="level3 nav-leaf"><a href="../cbor-json/">Introduction</a></li>
    <li class="level1 nav-header">cookbooks</li>
    <li class="level2 nav-leaf"><a href="../../cookbooks/jq/">Reading/transforming/writing JSON data</a></li>
    <li class="level2 nav-leaf"><a href="../../cookbooks/jsonlines/">Handling JSON Lines data</a></li>
  </ul>

  <ul class="nav-list">
    <li><div id="search"></div></li>
  </ul>

</nav>

<script>
window.addEventListener('DOMContentLoaded', (event) => {
  new PagefindUI({ element: "#search", showSubResults: true, showImages: false });
});
</script>


    <div id="container">

      
<nav id="page-nav">
  <p class="header"><a href="#">Introduction</a></p>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="#basic-usage">Basic usage</a></li>
    <li class="level1 nav-leaf"><a href="#resolvers">Resolvers</a></li>
    <li class="level1 nav-leaf"><a href="#normalization">Normalization</a></li>
    <li class="level1 nav-leaf"><a href="#dom-builder-and-eventifier">DOM builder and eventifier</a></li>
    <li class="level1 nav-leaf"><a href="#xml-renderers">XML Renderers</a></li>
  </ul>

  <p class="footer"></p>
</nav>


      <main class="content">

        <h1 id="introduction" class="title">Introduction</h1>
        <p>Module: <a href="https://mvnrepository.com/artifact/org.gnieh/fs2-data-xml_2.13"><img src="https://img.shields.io/maven-central/v/org.gnieh/fs2-data-xml_2.13.svg" alt="Maven Central"></a></p>
        <p>The <code>fs2-data-xml</code> module provides tools to parse XML data in a streaming manner.</p>
        
        <h2 id="basic-usage" class="section"><a class="anchor-link left" href="#basic-usage"><i class="icofont-laika link">&#xef71;</i></a>Basic usage</h2>
        <p>To create a stream of XML events from an input stream, use the <code>events</code> pipe in <code>fs2.data.xml</code> package.</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">effect</span><span>.</span><span class="identifier">_</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">effect</span><span>.</span><span class="identifier">unsafe</span><span>.</span><span class="identifier">implicits</span><span>.</span><span class="identifier">global</span><span>

</span><span class="keyword">import</span><span> </span><span class="identifier">fs2</span><span>.</span><span class="identifier">_</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">fs2</span><span>.</span><span class="identifier">data</span><span>.</span><span class="identifier">xml</span><span>.</span><span class="identifier">_</span><span>

</span><span class="keyword">val</span><span> </span><span class="identifier">input</span><span> = </span><span class="string-literal">&quot;&quot;&quot;&lt;a xmlns:ns=&quot;http://test.ns&quot;&gt;
              |  &lt;ns:b ns:a=&quot;attribute&quot;&gt;text&lt;/ns:b&gt;
              |&lt;/a&gt;
              |&lt;a&gt;
              |  &lt;b/&gt;
              |  test entity resolution &amp;amp; normalization
              |&lt;/a&gt;&quot;&quot;&quot;</span><span>.</span><span class="identifier">stripMargin</span><span>
</span><span class="comment">// input: String = &quot;&quot;&quot;&lt;a xmlns:ns=&quot;http://test.ns&quot;&gt;
//   &lt;ns:b ns:a=&quot;attribute&quot;&gt;text&lt;/ns:b&gt;
// &lt;/a&gt;
// &lt;a&gt;
//   &lt;b/&gt;
//   test entity resolution &amp;amp; normalization
// &lt;/a&gt;&quot;&quot;&quot;
</span><span>
</span><span class="keyword">val</span><span> </span><span class="identifier">stream</span><span> = </span><span class="type-name">Stream</span><span>.</span><span class="identifier">emit</span><span>(</span><span class="identifier">input</span><span>).</span><span class="identifier">through</span><span>(</span><span class="identifier">events</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">String</span><span>]())
</span><span class="comment">// stream: Stream[[A]IO[A], XmlEvent] = Stream(..)
</span><span class="identifier">stream</span><span>.</span><span class="identifier">compile</span><span>.</span><span class="identifier">toList</span><span>.</span><span class="identifier">unsafeRunSync</span><span>()
</span><span class="comment">// res0: List[XmlEvent] = List(
//   StartDocument,
//   StartTag(
//     name = QName(prefix = None, local = &quot;a&quot;),
//     attributes = List(
//       Attr(
//         name = QName(prefix = Some(value = &quot;xmlns&quot;), local = &quot;ns&quot;),
//         value = List(XmlString(s = &quot;http://test.ns&quot;, isCDATA = false))
//       )
//     ),
//     isEmpty = false
//   ),
//   XmlString(
//     s = &quot;&quot;&quot;
//   &quot;&quot;&quot;,
//     isCDATA = false
//   ),
//   StartTag(
//     name = QName(prefix = Some(value = &quot;ns&quot;), local = &quot;b&quot;),
//     attributes = List(
//       Attr(
//         name = QName(prefix = Some(value = &quot;ns&quot;), local = &quot;a&quot;),
//         value = List(XmlString(s = &quot;attribute&quot;, isCDATA = false))
//       )
//     ),
//     isEmpty = false
//   ),
//   XmlString(s = &quot;text&quot;, isCDATA = false),
//   EndTag(name = QName(prefix = Some(value = &quot;ns&quot;), local = &quot;b&quot;)),
//   XmlString(
//     s = &quot;&quot;&quot;
// &quot;&quot;&quot;,
//     isCDATA = false
//   ),
//   EndTag(name = QName(prefix = None, local = &quot;a&quot;)),
//   EndDocument,
//   StartDocument,
//   StartTag(
//     name = QName(prefix = None, local = &quot;a&quot;),
//     attributes = List(),
//     isEmpty = false
//   ),
//   XmlString(
//     s = &quot;&quot;&quot;
//   &quot;&quot;&quot;,
//     isCDATA = false
//   ),
//   StartTag(
//     name = QName(prefix = None, local = &quot;b&quot;),
//     attributes = List(),
//     isEmpty = true
//   ),
//   EndTag(name = QName(prefix = None, local = &quot;b&quot;)),
//   XmlString(
//     s = &quot;&quot;&quot;
//   test entity resolution &quot;&quot;&quot;,
//     isCDATA = false
//   ),
//   XmlEntityRef(name = &quot;amp&quot;),
//   XmlString(
//     s = &quot;&quot;&quot; normalization
// &quot;&quot;&quot;,
//     isCDATA = false
//   ),
//   EndTag(name = QName(prefix = None, local = &quot;a&quot;)),
//   EndDocument
// )</span></code></pre>
        <p>The pipe validates the XML structure while parsing. It reads all the XML elements in the input stream and emits events as they are available.</p>
        
        <h2 id="resolvers" class="section"><a class="anchor-link left" href="#resolvers"><i class="icofont-laika link">&#xef71;</i></a>Resolvers</h2>
        <p>Namespace can be resolved by using the <code>namespaceResolver</code> pipe.</p>
        <pre><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">nsResolved</span><span> = </span><span class="identifier">stream</span><span>.</span><span class="identifier">through</span><span>(</span><span class="identifier">namespaceResolver</span><span>[</span><span class="type-name">IO</span><span>])
</span><span class="comment">// nsResolved: Stream[[x]IO[x], XmlEvent] = Stream(..)
</span><span class="identifier">nsResolved</span><span>.</span><span class="identifier">compile</span><span>.</span><span class="identifier">toList</span><span>.</span><span class="identifier">unsafeRunSync</span><span>()
</span><span class="comment">// res1: List[XmlEvent] = List(
//   StartDocument,
//   StartTag(
//     name = QName(
//       prefix = Some(value = &quot;http://www.w3.org/XML/1998/namespace&quot;),
//       local = &quot;a&quot;
//     ),
//     attributes = List(
//       Attr(
//         name = QName(prefix = Some(value = &quot;xmlns&quot;), local = &quot;ns&quot;),
//         value = List(XmlString(s = &quot;http://test.ns&quot;, isCDATA = false))
//       )
//     ),
//     isEmpty = false
//   ),
//   XmlString(
//     s = &quot;&quot;&quot;
//   &quot;&quot;&quot;,
//     isCDATA = false
//   ),
//   StartTag(
//     name = QName(prefix = Some(value = &quot;http://test.ns&quot;), local = &quot;b&quot;),
//     attributes = List(
//       Attr(
//         name = QName(prefix = Some(value = &quot;http://test.ns&quot;), local = &quot;a&quot;),
//         value = List(XmlString(s = &quot;attribute&quot;, isCDATA = false))
//       )
//     ),
//     isEmpty = false
//   ),
//   XmlString(s = &quot;text&quot;, isCDATA = false),
//   EndTag(name = QName(prefix = Some(value = &quot;http://test.ns&quot;), local = &quot;b&quot;)),
//   XmlString(
//     s = &quot;&quot;&quot;
// &quot;&quot;&quot;,
//     isCDATA = false
//   ),
//   EndTag(
//     name = QName(
//       prefix = Some(value = &quot;http://www.w3.org/XML/1998/namespace&quot;),
//       local = &quot;a&quot;
//     )
//   ),
//   EndDocument,
//   StartDocument,
//   StartTag(
//     name = QName(
//       prefix = Some(value = &quot;http://www.w3.org/XML/1998/namespace&quot;),
//       local = &quot;a&quot;
//     ),
//     attributes = List(),
//     isEmpty = false
//   ),
//   XmlString(
//     s = &quot;&quot;&quot;
//   &quot;&quot;&quot;,
//     isCDATA = false
//   ),
//   StartTag(
//     name = QName(
//       prefix = Some(value = &quot;http://www.w3.org/XML/1998/namespace&quot;),
//       local = &quot;b&quot;
//     ),
//     attributes = List(),
//     isEmpty = true
//   ),
//   EndTag(
//     name = QName(
//       prefix = Some(value = &quot;http://www.w3.org/XML/1998/namespace&quot;),
//       local = &quot;b&quot;
//     )
//   ),
//   XmlString(
//     s = &quot;&quot;&quot;
//   test entity resolution &quot;&quot;&quot;,
//     isCDATA = false
//   ),
//   XmlEntityRef(name = &quot;amp&quot;),
//   XmlString(
//     s = &quot;&quot;&quot; normalization
// &quot;&quot;&quot;,
//     isCDATA = false
//   ),
//   EndTag(
//     name = QName(
//       prefix = Some(value = &quot;http://www.w3.org/XML/1998/namespace&quot;),
//       local = &quot;a&quot;
//     )
//   ),
//   EndDocument
// )</span></code></pre>
        <p>Using the <code>referenceResolver</code> pipe, entity and character references can be resolved. By defaut the standard <code>xmlEntities</code> mapping is used, but it can be replaced by any mapping you see fit.</p>
        <pre><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">entityResolved</span><span> = </span><span class="identifier">stream</span><span>.</span><span class="identifier">through</span><span>(</span><span class="identifier">referenceResolver</span><span>[</span><span class="type-name">IO</span><span>]())
</span><span class="comment">// entityResolved: Stream[[x]IO[x], XmlEvent] = Stream(..)
</span><span class="identifier">entityResolved</span><span>.</span><span class="identifier">compile</span><span>.</span><span class="identifier">toList</span><span>.</span><span class="identifier">unsafeRunSync</span><span>()
</span><span class="comment">// res2: List[XmlEvent] = List(
//   StartDocument,
//   StartTag(
//     name = QName(prefix = None, local = &quot;a&quot;),
//     attributes = List(
//       Attr(
//         name = QName(prefix = Some(value = &quot;xmlns&quot;), local = &quot;ns&quot;),
//         value = List(XmlString(s = &quot;http://test.ns&quot;, isCDATA = false))
//       )
//     ),
//     isEmpty = false
//   ),
//   XmlString(
//     s = &quot;&quot;&quot;
//   &quot;&quot;&quot;,
//     isCDATA = false
//   ),
//   StartTag(
//     name = QName(prefix = Some(value = &quot;ns&quot;), local = &quot;b&quot;),
//     attributes = List(
//       Attr(
//         name = QName(prefix = Some(value = &quot;ns&quot;), local = &quot;a&quot;),
//         value = List(XmlString(s = &quot;attribute&quot;, isCDATA = false))
//       )
//     ),
//     isEmpty = false
//   ),
//   XmlString(s = &quot;text&quot;, isCDATA = false),
//   EndTag(name = QName(prefix = Some(value = &quot;ns&quot;), local = &quot;b&quot;)),
//   XmlString(
//     s = &quot;&quot;&quot;
// &quot;&quot;&quot;,
//     isCDATA = false
//   ),
//   EndTag(name = QName(prefix = None, local = &quot;a&quot;)),
//   EndDocument,
//   StartDocument,
//   StartTag(
//     name = QName(prefix = None, local = &quot;a&quot;),
//     attributes = List(),
//     isEmpty = false
//   ),
//   XmlString(
//     s = &quot;&quot;&quot;
//   &quot;&quot;&quot;,
//     isCDATA = false
//   ),
//   StartTag(
//     name = QName(prefix = None, local = &quot;b&quot;),
//     attributes = List(),
//     isEmpty = true
//   ),
//   EndTag(name = QName(prefix = None, local = &quot;b&quot;)),
//   XmlString(
//     s = &quot;&quot;&quot;
//   test entity resolution &quot;&quot;&quot;,
//     isCDATA = false
//   ),
//   XmlString(s = &quot;&amp;&quot;, isCDATA = false),
//   XmlString(
//     s = &quot;&quot;&quot; normalization
// &quot;&quot;&quot;,
//     isCDATA = false
//   ),
//   EndTag(name = QName(prefix = None, local = &quot;a&quot;)),
//   EndDocument
// )</span></code></pre>
        
        <h2 id="normalization" class="section"><a class="anchor-link left" href="#normalization"><i class="icofont-laika link">&#xef71;</i></a>Normalization</h2>
        <p>Once entites and namespaces are resolved, the events might be numerous and can be normalized to avoid emitting too many of them. For instance, after reference resolution, consecutive text events can be merged. This is achieved by using the <code>normalize</code> pipe.</p>
        <pre><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">normalized</span><span> = </span><span class="identifier">entityResolved</span><span>.</span><span class="identifier">through</span><span>(</span><span class="identifier">normalize</span><span>)
</span><span class="comment">// normalized: Stream[[x]IO[x], XmlEvent] = Stream(..)
</span><span class="identifier">normalized</span><span>.</span><span class="identifier">compile</span><span>.</span><span class="identifier">toList</span><span>.</span><span class="identifier">unsafeRunSync</span><span>()
</span><span class="comment">// res3: List[XmlEvent] = List(
//   StartDocument,
//   StartTag(
//     name = QName(prefix = None, local = &quot;a&quot;),
//     attributes = List(
//       Attr(
//         name = QName(prefix = Some(value = &quot;xmlns&quot;), local = &quot;ns&quot;),
//         value = List(XmlString(s = &quot;http://test.ns&quot;, isCDATA = false))
//       )
//     ),
//     isEmpty = false
//   ),
//   XmlString(
//     s = &quot;&quot;&quot;
//   &quot;&quot;&quot;,
//     isCDATA = false
//   ),
//   StartTag(
//     name = QName(prefix = Some(value = &quot;ns&quot;), local = &quot;b&quot;),
//     attributes = List(
//       Attr(
//         name = QName(prefix = Some(value = &quot;ns&quot;), local = &quot;a&quot;),
//         value = List(XmlString(s = &quot;attribute&quot;, isCDATA = false))
//       )
//     ),
//     isEmpty = false
//   ),
//   XmlString(s = &quot;text&quot;, isCDATA = false),
//   EndTag(name = QName(prefix = Some(value = &quot;ns&quot;), local = &quot;b&quot;)),
//   XmlString(
//     s = &quot;&quot;&quot;
// &quot;&quot;&quot;,
//     isCDATA = false
//   ),
//   EndTag(name = QName(prefix = None, local = &quot;a&quot;)),
//   EndDocument,
//   StartDocument,
//   StartTag(
//     name = QName(prefix = None, local = &quot;a&quot;),
//     attributes = List(),
//     isEmpty = false
//   ),
//   XmlString(
//     s = &quot;&quot;&quot;
//   &quot;&quot;&quot;,
//     isCDATA = false
//   ),
//   StartTag(
//     name = QName(prefix = None, local = &quot;b&quot;),
//     attributes = List(),
//     isEmpty = true
//   ),
//   EndTag(name = QName(prefix = None, local = &quot;b&quot;)),
//   XmlString(
//     s = &quot;&quot;&quot;
//   test entity resolution &amp; normalization
// &quot;&quot;&quot;,
//     isCDATA = false
//   ),
//   EndTag(name = QName(prefix = None, local = &quot;a&quot;)),
//   EndDocument
// )</span></code></pre>
        
        <h2 id="dom-builder-and-eventifier" class="section"><a class="anchor-link left" href="#dom-builder-and-eventifier"><i class="icofont-laika link">&#xef71;</i></a>DOM builder and eventifier</h2>
        <p>To handle XML DOM, you can use the types and pipes available in the <code>fs2.data.xml.dom</code> package.</p>
        <p>XML DOM can be built if you provide an implicit <a class="api" href="https://www.javadoc.io/doc/org.gnieh/fs2-data-docs_2.13/1.11.0/fs2/data/fs2/data/xml/dom/DocumentBuilder.html">DocumentBuilder</a> to the <code>documents</code> pipe. The <code>DocumentBuilder[Doc]</code> typeclass describes how XML DOM of type <code>Doc</code> are built from an XML event stream.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">dom</span><span>.</span><span class="identifier">_</span><span>

</span><span class="keyword">trait</span><span> </span><span class="type-name">SomeDocType</span><span>

</span><span class="keyword">implicit</span><span> </span><span class="keyword">val</span><span> </span><span class="identifier">builder</span><span>: </span><span class="type-name">DocumentBuilder</span><span>[</span><span class="type-name">SomeDocType</span><span>] = ???
</span><span class="identifier">stream</span><span>.</span><span class="identifier">through</span><span>(</span><span class="identifier">documents</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">SomeDocType</span><span>])</span></code></pre>
        <p>Conversely, the pipe transforming a stream of <code>Doc</code>s into a stream of XML events is called <code>eventify</code> and requires an implicit <a class="api" href="https://www.javadoc.io/doc/org.gnieh/fs2-data-docs_2.13/1.11.0/fs2/data/fs2/data/xml/dom/DocumentEventifier.html">DocumentEventifier</a> in scope.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">dom</span><span>.</span><span class="identifier">_</span><span>

</span><span class="keyword">trait</span><span> </span><span class="type-name">SomeDocType</span><span>

</span><span class="keyword">implicit</span><span> </span><span class="keyword">val</span><span> </span><span class="identifier">builder</span><span>: </span><span class="type-name">DocumentBuilder</span><span>[</span><span class="type-name">SomeDocType</span><span>] = ???
</span><span class="keyword">implicit</span><span> </span><span class="keyword">val</span><span> </span><span class="identifier">eventifier</span><span>: </span><span class="type-name">DocumentEventifier</span><span>[</span><span class="type-name">SomeDocType</span><span>] = ???

</span><span class="identifier">stream</span><span>.</span><span class="identifier">through</span><span>(</span><span class="identifier">documents</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">SomeDocType</span><span>])
      .</span><span class="identifier">through</span><span>(</span><span class="identifier">eventify</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">SomeDocType</span><span>])</span></code></pre>
        
        <h2 id="xml-renderers" class="section"><a class="anchor-link left" href="#xml-renderers"><i class="icofont-laika link">&#xef71;</i></a>XML Renderers</h2>
        <p>Once you got an XML event stream, selected and transformed what you needed in it, you can then write the resulting event stream to some storage. This can be achieved using renderers.</p>
        <p>For instance, let&#39;s say you want to write the resulting XML stream to a file in raw form (i.e. without trying to format the nested tags and text), you can do:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">fs2</span><span>.</span><span class="identifier">io</span><span>.</span><span class="identifier">file</span><span>.{</span><span class="type-name">Files</span><span>, </span><span class="type-name">Flags</span><span>, </span><span class="type-name">Path</span><span>}

</span><span class="identifier">stream</span><span>
  .</span><span class="identifier">through</span><span>(</span><span class="identifier">render</span><span>.</span><span class="identifier">raw</span><span>())
  .</span><span class="identifier">through</span><span>(</span><span class="identifier">text</span><span>.</span><span class="identifier">utf8</span><span>.</span><span class="identifier">encode</span><span>)
  .</span><span class="identifier">through</span><span>(</span><span class="type-name">Files</span><span>[</span><span class="type-name">IO</span><span>].</span><span class="identifier">writeAll</span><span>(</span><span class="type-name">Path</span><span>(</span><span class="string-literal">&quot;/some/path/to/file.xml&quot;</span><span>), </span><span class="type-name">Flags</span><span>.</span><span class="type-name">Write</span><span>))
  .</span><span class="identifier">compile</span><span>
  .</span><span class="identifier">drain</span></code></pre>
        <p>There exists also a <code>pretty()</code> renderer, that indents inner tags and text by the given indent string.</p>
        <p>If you are interested in the String rendering as a value, the library also provides <code>Collector</code>s:</p>
        <pre><code class="nohighlight"><span class="identifier">stream</span><span>.</span><span class="identifier">compile</span><span>.</span><span class="identifier">to</span><span>(</span><span class="identifier">collector</span><span>.</span><span class="identifier">raw</span><span>()).</span><span class="identifier">unsafeRunSync</span><span>()
</span><span class="comment">// res7: String = &quot;&quot;&quot;&lt;a xmlns:ns=&quot;http://test.ns&quot;&gt;
//   &lt;ns:b ns:a=&quot;attribute&quot;&gt;text&lt;/ns:b&gt;
// &lt;/a&gt;&lt;a&gt;
//   &lt;b/&gt;
//   test entity resolution &amp;amp; normalization
// &lt;/a&gt;&quot;&quot;&quot;
</span><span>
</span><span class="identifier">stream</span><span>.</span><span class="identifier">compile</span><span>.</span><span class="identifier">to</span><span>(</span><span class="identifier">collector</span><span>.</span><span class="identifier">pretty</span><span>()).</span><span class="identifier">unsafeRunSync</span><span>()
</span><span class="comment">// res8: String = &quot;&quot;&quot;&lt;a xmlns:ns=&quot;http://test.ns&quot;&gt;
//   &lt;ns:b ns:a=&quot;attribute&quot;&gt;
//     text
//   &lt;/ns:b&gt;
// &lt;/a&gt;
// &lt;a&gt;
//   &lt;b /&gt;
//   test entity resolution &amp;amp; normalization
// &lt;/a&gt;&quot;&quot;&quot;</span></code></pre>

        
<hr class="footer-rule"/>
<footer>
  <code>fs2-data</code> is a <a href="https://typelevel.org/">Typelevel</a> affiliate project distributed under the <a href="https://www.apache.org/licenses/LICENSE-2.0.txt">Apache-2.0</a> license.
</footer>


      </main>

    </div>

  </body>

</html>