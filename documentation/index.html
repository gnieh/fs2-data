<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>fs2-data - Documentation</title>
    <link rel="stylesheet" href="/css/stylesheet.css">
    <link rel="stylesheet" href="/css/syntax.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="/css/materialize.min.css" media="screen,projection"/>
    <style>body{font-family: overpass, sans-serif; }</style>

    <script type="text/javascript" src="/js/materialize.min.js"></script>

    <!-- search index -->
    <link rel="stylesheet" href="/css/stork.css" />
    <script src="/js/stork.js"></script>

    <meta name="generator" content="Nanoc 4.12.14">
  </head>
  <body>
    <header>
        <nav class="nav-extended red darken-2">
          <a href="#!" class="brand-logo right">fs2-data</a>
          <a href="#" data-target="collapsed" class="sidenav-trigger"><i class="material-icons">menu</i></a>
          <div class="nav-wrapper">
            <ul id="nav-mobile" class="left hide-on-med-and-down">
              <li><a href="/">Home</a></li>
              <li><a href="/documentation/">Documentation</a></li>
              <li><a href="/api/">Scaladoc</a></li>
              <li><a href="https://github.com/gnieh/fs2-data">Github</a></li>
              <li><i class="material-icons">search</i></li>
              <li>
                <form>
                  <div class="input-field">
                    <input data-stork="search" id="search" type="search" required placeholder="Search the website" autocomplete="off" />
                  </div>
                </form>
              </li>
            </ul>
          </div>
          
          
          <div class="nav-content">
            <ul class="tabs tabs-transparent">
              
              <li class="tab"><a href="/documentation/cbor/">CBOR</a></li>
              
              <li class="tab"><a href="/documentation/cbor-json/">CBOR/JSON</a></li>
              
              <li class="tab"><a href="/documentation/csv/">CSV</a></li>
              
              <li class="tab"><a href="/documentation/json/">JSON</a></li>
              
              <li class="tab"><a href="/documentation/xml/">XML</a></li>
              
            </ul>
          </div>
          
        </nav>
        <div class="stork-wrapper-flat">
          <div data-stork="search-output" class="stork-output"></div>
        </div>

    </header>

    <ul class="sidenav" id="collapsed">
      <li><a href="/">Home</a></li>
      <li><a href="/documentation/">Documentation</a></li>
      <li><a href="/api/">Scaladoc</a></li>
      <li><a href="https://github.com/gnieh/fs2-data">Github</a></li>
    </ul>

    
    <div class="fixed-action-btn tooltipped" data-position="left" data-tooltip="Edit this page">
      <a class="btn-floating btn-large blue darken-2" href="https://github.com/gnieh/fs2-data/edit/main/documentation/docs/index.md" target="_blank">
        <i class="large material-icons">mode_edit</i>
      </a>
    </div>
    

    <main>
      <div class="container">
        <h1 id="fs2-data-documentation"><code>fs2-data</code> Documentation</h1>

<ul id="markdown-toc">
  <li><a href="#fs2-data-documentation" id="markdown-toc-fs2-data-documentation"><code>fs2-data</code> Documentation</a>    <ul>
      <li><a href="#parsing-textual-formats" id="markdown-toc-parsing-textual-formats">Parsing textual formats</a></li>
      <li><a href="#reading-text-inputs-from-a-file" id="markdown-toc-reading-text-inputs-from-a-file">Reading text inputs from a file</a>        <ul>
          <li><a href="#decoding-textual-inputs" id="markdown-toc-decoding-textual-inputs">Decoding textual inputs</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p><code>fs2-data</code> consists of several modules, handling a different data format, and sub-modules for each data format, adding more features (but also more dependencies). The core module for each data format has no other dependency than <code>fs2</code> and provides tools to parse and transform data in a streaming manner.</p>

<p>For each module, the entry point is an <a href="https://fs2.io/guide.html#statefully-transforming-streams">fs2 <code>Pipe</code></a> transforming a stream of some input (typically <code>Char</code>, <code>String</code>, or <code>Byte</code>) into some tokens or events. All parsers are streaming parsers, which means that the parsed tree is never constructed in memory by the parser, but instead, is emitted as a sequence of <em>tokens</em> or <em>events</em> (similar to <a href="https://en.wikipedia.org/wiki/Simple_API_for_XML">SAX</a>), and that the input data is not fully held in memory either. The parsers read the input as it comes, and emit the tokens as soon as possible, discarding the input data that is not useful anymore.</p>

<p>Available data modules are:</p>

<ul>
  <li>
    <p>binary format</p>

    <ul>
      <li><a href="/documentation/cbor/">CBOR</a> - CBOR parser and transformation</li>
    </ul>
  </li>
  <li>
    <p>textual format</p>

    <ul>
      <li>
        <p><a href="/documentation/cbor-json/">CBOR/JSON</a> - CBOR/JSON interoperability library</p>
      </li>
      <li>
        <p><a href="/documentation/csv/">CSV</a> - CSV parser and codec</p>
      </li>
      <li>
        <p><a href="/documentation/json/">JSON</a> - JSON parser and transformation</p>
      </li>
      <li>
        <p><a href="/documentation/xml/">XML</a> - XML parser and validator</p>
      </li>
    </ul>
  </li>
</ul>

<h3 id="parsing-textual-formats">Parsing textual formats</h3>

<p>The general pattern for the text parsers (JSON, XML, CSV, …) is to have a pipe with this signature:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">fs2._</span>
<span class="k">import</span> <span class="nn">fs2.data.text.CharLikeChunks</span>

<span class="c1">// the Token type depends on the format</span>
<span class="k">trait</span> <span class="nc">Token</span>

<span class="k">def</span> <span class="nf">tokens</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]</span>, <span class="kt">T</span><span class="o">](</span><span class="k">implicit</span> <span class="n">T</span><span class="k">:</span> <span class="kt">CharLikeChunks</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">T</span><span class="o">])</span><span class="k">:</span> <span class="kt">Pipe</span><span class="o">[</span><span class="kt">F</span>, <span class="kt">T</span>, <span class="kt">Token</span><span class="o">]</span> <span class="k">=</span>
  <span class="n">s</span> <span class="k">=&gt;</span> <span class="nv">Stream</span><span class="o">.</span><span class="py">suspend</span><span class="o">(???)</span>
</code></pre></div></div>

<p>The input stream can be of any type <code>T</code> which can be used to read characters from. <code>fs2-data</code> provides by default implementations for types <code>Char</code> and <code>String</code>, so that you can write:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Stream of `Char`</span>
<span class="nv">Stream</span><span class="o">.</span><span class="py">emits</span><span class="o">(</span><span class="s">"Some input string"</span><span class="o">).</span><span class="py">through</span><span class="o">(</span><span class="n">tokens</span><span class="o">[</span><span class="kt">Pure</span>, <span class="kt">Char</span><span class="o">])</span>
<span class="c1">// res0: Stream[[x]Pure[x], Token] = Stream(..)</span>

<span class="c1">// Stream of `String`</span>
<span class="nv">Stream</span><span class="o">.</span><span class="py">emit</span><span class="o">(</span><span class="s">"Some input string"</span><span class="o">).</span><span class="py">through</span><span class="o">(</span><span class="n">tokens</span><span class="o">[</span><span class="kt">Pure</span>, <span class="kt">String</span><span class="o">])</span>
<span class="c1">// res1: Stream[[x]Pure[x], Token] = Stream(..)</span>
</code></pre></div></div>

<h3 id="reading-text-inputs-from-a-file">Reading text inputs from a file</h3>

<p>A common pattern when using this library to read data from a file is to start by build a <code>Stream[F, Byte]</code> as follows:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">cats.effect._</span>

<span class="k">import</span> <span class="nn">fs2._</span>
<span class="k">import</span> <span class="nn">fs2.io.file.</span><span class="o">{</span><span class="nc">Files</span><span class="o">,</span> <span class="nc">Flags</span><span class="o">,</span> <span class="nc">Path</span><span class="o">}</span>

<span class="nc">Files</span><span class="o">[</span><span class="kt">IO</span><span class="o">]</span>
  <span class="o">.</span><span class="py">readAll</span><span class="o">(</span><span class="nc">Path</span><span class="o">(</span><span class="s">"/some/path/to/a/file.data"</span><span class="o">),</span> <span class="mi">1024</span><span class="o">,</span> <span class="nv">Flags</span><span class="o">.</span><span class="py">Read</span><span class="o">)</span>
  <span class="c1">// perform your decoding, parsing, and transformation here</span>
  <span class="o">.</span><span class="py">compile</span>
  <span class="o">.</span><span class="py">drain</span>
</code></pre></div></div>

<p>For textual data formats (JSON, XML, CSV, …) this stream needs to be decoded according to the file encoding.</p>

<h4 id="decoding-textual-inputs">Decoding textual inputs</h4>

<p>If your file is encoded using UTF-8 or a common single-byte encoding, you can use the built-in support <code>fs2-data</code> has for these encodings, which lives in the <a href="/api/fs2/data/text/index.html"><code>fs2.data.text</code> package</a>.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// for instance if your input is encoded in ISO-8859-1 aka latin1</span>
<span class="k">import</span> <span class="nn">fs2.data.text.latin1._</span>
<span class="c1">// if you have UTF-8 instead:</span>
<span class="c1">// import fs2.data.text.utf8._</span>

<span class="nc">Files</span><span class="o">[</span><span class="kt">IO</span><span class="o">]</span>
  <span class="o">.</span><span class="py">readAll</span><span class="o">(</span><span class="nc">Path</span><span class="o">(</span><span class="s">"/some/path/to/a/file.data"</span><span class="o">),</span> <span class="mi">1024</span><span class="o">,</span> <span class="nv">Flags</span><span class="o">.</span><span class="py">Read</span><span class="o">)</span>
  <span class="c1">// decoding is done by the now in scope `CharLikeChunks[IO, Byte]` instance</span>
  <span class="o">.</span><span class="py">through</span><span class="o">(</span><span class="n">tokens</span><span class="o">)</span>
  <span class="o">.</span><span class="py">compile</span>
  <span class="o">.</span><span class="py">drain</span>
</code></pre></div></div>


      </div>
    </main>

    <footer class="page-footer red lighten-2">
      <div class="footer-copyright red darken-2">
        <div class="container">
          Copyright © 2019-2023 <a class="grey-text text-lighten-4" href="https://fosstodon.org/@lucassatabin">@lucassatabin</a>
          <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" class="grey-text text-lighten-4 right" /></a>
          <br />
          <a href="https://typelevel.org/projects/"><img alt="Typelevel Affiliate Project" style="border-width:0" src="https://img.shields.io/badge/typelevel-affiliate%20project-FFB4B5.svg" /></a>
          <a href="https://discord.gg/7qNAFsYkTn"><img alt="Discord" style="border-width:0" src="https://img.shields.io/discord/632277896739946517.svg?label=&logo=discord&logoColor=ffffff&color=404244&labelColor=6A7EC2" /></a>
        </div>
      </div>
    </footer>

    <script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function() {
      var elems = document.querySelectorAll('.sidenav');
      var instances = M.Sidenav.init(elems, {});
    });
    document.addEventListener('DOMContentLoaded', function() {
      var elems = document.querySelectorAll('.tooltipped');
      var instances = M.Tooltip.init(elems, {});
    });

    stork.initialize("/js/stork.wasm")
    stork.register("search", "/index.st", { showCloseButton: false })
    </script>

</html>
