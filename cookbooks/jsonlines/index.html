<!DOCTYPE html>
<html lang="en">
  
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Typelevel Laika + Helium Theme" />
  <title>Handling JSON Lines data</title>
  
  <meta name="author" content="Lucas Satabin"/>
  
  <meta name="author" content="Yannick Heiber"/>
  
  
  <meta name="description" content="site"/>
  
  
  
  <link rel="icon" sizes="32x32" type="image/png" href="https://typelevel.org/img/favicon.png"/>
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700">
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:500">
  
  <link rel="stylesheet" type="text/css" href="/pagefind/pagefind-ui.css" />
    <link rel="stylesheet" type="text/css" href="../../helium/site/icofont.min.css" />
    <link rel="stylesheet" type="text/css" href="../../helium/site/laika-helium.css" />
  <script src="/pagefind/pagefind-ui.js"></script>
    <script src="../../helium/site/laika-helium.js"></script>
  
  
  <script> /* for avoiding page load transitions */ </script>
</head>

  <body>

    <header id="top-bar" class="light-default dark-default">

  <div class="row">
    <a id="nav-icon">
      <i class="icofont-laika navigationMenu" title="Navigation">&#xefa2;</i>
    </a>
    
    
  </div>

  <a class="image-link" href="../../"><img src="../../media/logo-header.svg"></a>

  <div class="row links">
    
    <a class="icon-link svg-link" href="https://www.javadoc.io/doc/org.gnieh/fs2-data-docs_2.13/1.11.0/fs2/data/index.html"><span class="api" title="API"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M75,47.5c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm-50,-0c13.246,-0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,-0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm2.705,16.735l7.239,0l0.622,-4.904l-21.833,0l-0,4.904l7.589,0l0,22.067l6.383,0l-0,-22.067Zm58.076,7.265c-0,-8.757 -3.698,-14.166 -10.781,-14.166c-7.083,-0 -10.781,5.604 -10.781,14.166c0,8.757 3.698,14.166 10.781,14.166c7.083,0 10.781,-5.604 10.781,-14.166Zm-6.539,0c0,6.538 -1.128,9.496 -4.242,9.496c-2.997,0 -4.242,-2.88 -4.242,-9.496c-0,-6.616 1.206,-9.496 4.242,-9.496c3.036,-0 4.242,2.88 4.242,9.496Zm-29.242,-67c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm0.512,9.834c-7.122,-0 -12.609,5.098 -12.609,14.127c-0,9.263 5.215,14.205 12.532,14.205c4.164,0 7.083,-1.634 9.068,-3.658l-2.88,-3.697c-1.518,1.206 -3.153,2.413 -5.838,2.413c-3.697,-0 -6.266,-2.763 -6.266,-9.263c-0,-6.616 2.724,-9.379 6.149,-9.379c2.102,-0 3.892,0.778 5.371,1.984l3.113,-3.775c-2.257,-1.868 -4.748,-2.957 -8.64,-2.957Z"/>
  </g>
</svg></span></a>
    
    <a class="icon-link svg-link" href="https://github.com/gnieh/fs2-data"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
    <a class="icon-link glyph-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika chat" title="Chat">&#xeed5;</i></a>
    
    <a class="icon-link svg-link" href="https://fosstodon.org/@lucassatabin"><span class="mastodon" title="Mastodon"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <g class="svg-shape">
    <path d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a3.614 3.614 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522c0-.859.22-1.541.66-2.046.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764.442.505.661 1.187.661 2.046v4.203z"/>
  </g>
</svg></span></a>
    
  </div>  

</header>
    
    <nav id="sidebar">

  <div class="row">
    
    <a class="icon-link svg-link" href="https://www.javadoc.io/doc/org.gnieh/fs2-data-docs_2.13/1.11.0/fs2/data/index.html"><span class="api" title="API"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M75,47.5c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm-50,-0c13.246,-0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,-0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm2.705,16.735l7.239,0l0.622,-4.904l-21.833,0l-0,4.904l7.589,0l0,22.067l6.383,0l-0,-22.067Zm58.076,7.265c-0,-8.757 -3.698,-14.166 -10.781,-14.166c-7.083,-0 -10.781,5.604 -10.781,14.166c0,8.757 3.698,14.166 10.781,14.166c7.083,0 10.781,-5.604 10.781,-14.166Zm-6.539,0c0,6.538 -1.128,9.496 -4.242,9.496c-2.997,0 -4.242,-2.88 -4.242,-9.496c-0,-6.616 1.206,-9.496 4.242,-9.496c3.036,-0 4.242,2.88 4.242,9.496Zm-29.242,-67c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm0.512,9.834c-7.122,-0 -12.609,5.098 -12.609,14.127c-0,9.263 5.215,14.205 12.532,14.205c4.164,0 7.083,-1.634 9.068,-3.658l-2.88,-3.697c-1.518,1.206 -3.153,2.413 -5.838,2.413c-3.697,-0 -6.266,-2.763 -6.266,-9.263c-0,-6.616 2.724,-9.379 6.149,-9.379c2.102,-0 3.892,0.778 5.371,1.984l3.113,-3.775c-2.257,-1.868 -4.748,-2.957 -8.64,-2.957Z"/>
  </g>
</svg></span></a>
    
    <a class="icon-link svg-link" href="https://github.com/gnieh/fs2-data"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
    <a class="icon-link glyph-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika chat" title="Chat">&#xeed5;</i></a>
    
    <a class="icon-link svg-link" href="https://fosstodon.org/@lucassatabin"><span class="mastodon" title="Mastodon"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <g class="svg-shape">
    <path d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a3.614 3.614 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522c0-.859.22-1.541.66-2.046.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764.442.505.661 1.187.661 2.046v4.203z"/>
  </g>
</svg></span></a>
    
  </div>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="../../">Home</a></li>
    <li class="level1 nav-header">documentation</li>
    <li class="level2 nav-leaf"><a href="../../documentation/">Introduction</a></li>
    <li class="level2 nav-header">csv</li>
    <li class="level3 nav-leaf"><a href="../../documentation/csv/">Introduction</a></li>
    <li class="level3 nav-leaf"><a href="../../documentation/csv/generic/">Generic</a></li>
    <li class="level2 nav-header">json</li>
    <li class="level3 nav-leaf"><a href="../../documentation/json/">Introduction</a></li>
    <li class="level3 nav-leaf"><a href="../../documentation/json/jsonpath/">JSONPath</a></li>
    <li class="level3 nav-leaf"><a href="../../documentation/json/jq/">JSON Queries</a></li>
    <li class="level3 nav-leaf"><a href="../../documentation/json/libraries/">JSON Libraries</a></li>
    <li class="level3 nav-leaf"><a href="../../documentation/json/jsonpatch/">JSON Patch</a></li>
    <li class="level3 nav-leaf"><a href="../../documentation/json/transformations/">Transformations</a></li>
    <li class="level2 nav-header">xml</li>
    <li class="level3 nav-leaf"><a href="../../documentation/xml/">Introduction</a></li>
    <li class="level3 nav-leaf"><a href="../../documentation/xml/xpath/">XPath</a></li>
    <li class="level3 nav-leaf"><a href="../../documentation/xml/libraries/">XML Libraries</a></li>
    <li class="level2 nav-header">cbor</li>
    <li class="level3 nav-leaf"><a href="../../documentation/cbor/">Introduction</a></li>
    <li class="level2 nav-header">cbor-json</li>
    <li class="level3 nav-leaf"><a href="../../documentation/cbor-json/">Introduction</a></li>
    <li class="level1 nav-header">cookbooks</li>
    <li class="level2 nav-leaf"><a href="../jq/">Reading/transforming/writing JSON data</a></li>
    <li class="level2 active nav-leaf"><a href="#">Handling JSON Lines data</a></li>
  </ul>

  <ul class="nav-list">
    <li><div id="search"></div></li>
  </ul>

</nav>

<script>
window.addEventListener('DOMContentLoaded', (event) => {
  new PagefindUI({ element: "#search", showSubResults: true, showImages: false });
});
</script>


    <div id="container">

      
<nav id="page-nav">
  <p class="header"><a href="#">Handling JSON Lines data</a></p>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="#reading-json-lines-data">Reading JSON Lines data</a></li>
    <li class="level1 nav-leaf"><a href="#producing-json-lines-data">Producing JSON Lines data</a></li>
    <li class="level1 nav-leaf"><a href="#running-the-full-example">Running the full example</a></li>
  </ul>

  <p class="footer"></p>
</nav>


      <main class="content">

        <h1 id="handling-json-lines-data" class="title">Handling JSON Lines data</h1>
        <p>The <a href="https://jsonlines.org/">JSON Lines format</a> describes a way to represent JSON records on single lines. This allows to process records one at a time, reading them as they come.
        In this cookbook, we will demonstrate how such data can be read and produced using <code>fs2-data</code>.</p>
        
        <h2 id="reading-json-lines-data" class="section"><a class="anchor-link left" href="#reading-json-lines-data"><i class="icofont-laika link">&#xef71;</i></a>Reading JSON Lines data</h2>
        <p>The <code>fs2-data</code> <a href="../../documentation/json/">JSON module</a> can natively read concatenated JSON values in an input stream This means that we can naively read data from the input stream and we will get the token stream out of it.</p>
        <p>However, this way, we will not check that the input is actually respecting the JSON lines format. The format actually only has a few rules:</p>
        <ul>
          <li>Input must be UTF-8 encoded.</li>
        </ul>
        <ul>
          <li>Each line is a valid JSON value.</li>
        </ul>
        <ul>
          <li>Lines are separated by <code>\n</code>.</li>
        </ul>
        <p>We can leverage the operators provided by <code>fs2</code> and <code>fs2-data</code> to enforce these constraints when reading data.</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">effect</span><span>.</span><span class="identifier">unsafe</span><span>.</span><span class="identifier">implicits</span><span>.</span><span class="identifier">global</span><span>

</span><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">effect</span><span>.</span><span class="type-name">IO</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">fs2</span><span>.</span><span class="type-name">Stream</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">fs2</span><span>.</span><span class="identifier">data</span><span>.</span><span class="identifier">json</span><span>.</span><span class="type-name">JsonException</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">fs2</span><span>.</span><span class="identifier">data</span><span>.</span><span class="identifier">json</span><span>.</span><span class="identifier">circe</span><span>.</span><span class="identifier">_</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">fs2</span><span>.</span><span class="identifier">io</span><span>.</span><span class="identifier">file</span><span>.{</span><span class="type-name">Files</span><span>, </span><span class="type-name">Path</span><span>}
</span><span class="keyword">import</span><span> </span><span class="identifier">io</span><span>.</span><span class="identifier">circe</span><span>.</span><span class="type-name">Json</span><span>

</span><span class="keyword">def</span><span> </span><span class="declaration-name">readJsonLines</span><span>(</span><span class="identifier">input</span><span>: </span><span class="type-name">Stream</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">Byte</span><span>]): </span><span class="type-name">Stream</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">Json</span><span>] =
  </span><span class="identifier">input</span><span>
    </span><span class="comment">// rule #1: input must be UTF-8 encoded
</span><span>    .</span><span class="identifier">through</span><span>(</span><span class="identifier">fs2</span><span>.</span><span class="identifier">text</span><span>.</span><span class="identifier">utf8</span><span>.</span><span class="identifier">decode</span><span>)
    </span><span class="comment">// rule #3: new line delimiter is &#39;\n&#39;
</span><span>    .</span><span class="identifier">through</span><span>(</span><span class="identifier">fs2</span><span>.</span><span class="identifier">text</span><span>.</span><span class="identifier">lines</span><span>)
    .</span><span class="identifier">flatMap</span><span> { </span><span class="identifier">line</span><span> =&gt;
      </span><span class="comment">// rule #2: values must be encoded on single lines
</span><span>      </span><span class="type-name">Stream</span><span>
        .</span><span class="identifier">emit</span><span>(</span><span class="identifier">line</span><span>)
        .</span><span class="identifier">covary</span><span>[</span><span class="type-name">IO</span><span>]
        .</span><span class="identifier">through</span><span>(</span><span class="identifier">fs2</span><span>.</span><span class="identifier">data</span><span>.</span><span class="identifier">json</span><span>.</span><span class="identifier">ast</span><span>.</span><span class="identifier">parse</span><span>)
        .</span><span class="identifier">handleErrorWith</span><span> { </span><span class="identifier">t</span><span> =&gt;
          </span><span class="type-name">Stream</span><span>.</span><span class="identifier">raiseError</span><span>[</span><span class="type-name">IO</span><span>](</span><span class="type-name">JsonException</span><span>(</span><span class="string-literal">s&quot;&#39;</span><span class="substitution">$line</span><span class="string-literal">&#39; is not a valid JSON value&quot;</span><span>, </span><span class="identifier">inner</span><span> = </span><span class="identifier">t</span><span>))
        }
    }</span></code></pre>
        <p>Using this function, we can read a <a href="../data/jsonl/nested.jsonl">JSON Lines data file</a> and wrap the elements in an array.</p>
        <pre><code class="nohighlight"><span class="keyword">val</span><span> </span><span class="identifier">array</span><span> =
  </span><span class="type-name">Files</span><span>[</span><span class="type-name">IO</span><span>]
    .</span><span class="identifier">readAll</span><span>(</span><span class="type-name">Path</span><span>(</span><span class="string-literal">&quot;site/cookbooks/data/jsonl/nested.jsonl&quot;</span><span>))
    .</span><span class="identifier">through</span><span>(</span><span class="identifier">readJsonLines</span><span>)
    .</span><span class="identifier">through</span><span>(</span><span class="identifier">fs2</span><span>.</span><span class="identifier">data</span><span>.</span><span class="identifier">json</span><span>.</span><span class="identifier">ast</span><span>.</span><span class="identifier">tokenize</span><span>)
    .</span><span class="identifier">through</span><span>(</span><span class="identifier">fs2</span><span>.</span><span class="identifier">data</span><span>.</span><span class="identifier">json</span><span>.</span><span class="identifier">wrap</span><span>.</span><span class="identifier">asTopLevelArray</span><span>)
    .</span><span class="identifier">through</span><span>(</span><span class="identifier">fs2</span><span>.</span><span class="identifier">data</span><span>.</span><span class="identifier">json</span><span>.</span><span class="identifier">render</span><span>.</span><span class="identifier">pretty</span><span>())
</span><span class="comment">// array: Stream[[x]IO[x], String] = Stream(..)
</span><span>
</span><span class="identifier">array</span><span>
  .</span><span class="identifier">compile</span><span>
  .</span><span class="identifier">string</span><span>
  .</span><span class="identifier">unsafeRunSync</span><span>()
</span><span class="comment">// res0: String = &quot;&quot;&quot;[
//   {
//     &quot;name&quot;: &quot;Gilbert&quot;,
//     &quot;wins&quot;: [
//       [
//         &quot;straight&quot;,
//         &quot;7\u2663&quot;
//       ],
//       [
//         &quot;one pair&quot;,
//         &quot;10\u2665&quot;
//       ]
//     ]
//   },
//   {
//     &quot;name&quot;: &quot;Alexa&quot;,
//     &quot;wins&quot;: [
//       [
//         &quot;two pair&quot;,
//         &quot;4\u2660&quot;
//       ],
//       [
//         &quot;two pair&quot;,
//         &quot;9\u2660&quot;
//       ]
//     ]
//   },
//   {
//     &quot;name&quot;: &quot;May&quot;,
//     &quot;wins&quot;: []
//   },
//   {
//     &quot;name&quot;: &quot;Deloise&quot;,
//     &quot;wins&quot;: [
//       [
//         &quot;three of a kind&quot;,
//         &quot;5\u2663&quot;
//       ]
//     ]
//   }
// ]&quot;&quot;&quot;</span></code></pre>
        <p>This reading function will fail if the input data is not JSON Lines encoded.</p>
        <pre><code class="nohighlight"><span class="identifier">array</span><span>
  .</span><span class="identifier">through</span><span>(</span><span class="identifier">fs2</span><span>.</span><span class="identifier">text</span><span>.</span><span class="identifier">utf8</span><span>.</span><span class="identifier">encode</span><span>)
  .</span><span class="identifier">through</span><span>(</span><span class="identifier">readJsonLines</span><span>)
  .</span><span class="identifier">compile</span><span>
  .</span><span class="identifier">drain</span><span>
  .</span><span class="identifier">attempt</span><span>
  .</span><span class="identifier">unsafeRunSync</span><span>()
</span><span class="comment">// res1: Either[Throwable, Unit] = Left(
//   value = JsonException(
//     msg = &quot;&#39;[&#39; is not a valid JSON value&quot;,
//     context = None,
//     inner = JsonException(
//       msg = &quot;unexpected end of input&quot;,
//       context = None,
//       inner = null
//     )
//   )
// )</span></code></pre>
        
        <h2 id="producing-json-lines-data" class="section"><a class="anchor-link left" href="#producing-json-lines-data"><i class="icofont-laika link">&#xef71;</i></a>Producing JSON Lines data</h2>
        <p>Similarly, using <code>fs2</code> and <code>fs2-data</code> operators, we can generate a stream that will emit each record on a single line.</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">def</span><span> </span><span class="declaration-name">writeJsonLines</span><span>(</span><span class="identifier">input</span><span>: </span><span class="type-name">Stream</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">Json</span><span>]): </span><span class="type-name">Stream</span><span>[</span><span class="type-name">IO</span><span>, </span><span class="type-name">Byte</span><span>] =
  </span><span class="identifier">input</span><span>
    .</span><span class="identifier">flatMap</span><span> { </span><span class="identifier">data</span><span> =&gt;
      </span><span class="comment">// rule #2: values must be encoded on single lines
</span><span>      </span><span class="type-name">Stream</span><span>.</span><span class="identifier">emit</span><span>(</span><span class="identifier">data</span><span>).</span><span class="identifier">through</span><span>(</span><span class="identifier">fs2</span><span>.</span><span class="identifier">data</span><span>.</span><span class="identifier">json</span><span>.</span><span class="identifier">ast</span><span>.</span><span class="identifier">tokenize</span><span>).</span><span class="identifier">through</span><span>(</span><span class="identifier">fs2</span><span>.</span><span class="identifier">data</span><span>.</span><span class="identifier">json</span><span>.</span><span class="identifier">render</span><span>.</span><span class="identifier">compact</span><span>)
    }
    </span><span class="comment">// rule #3: new line delimiter is &#39;\n&#39;
</span><span>    .</span><span class="identifier">intersperse</span><span>(</span><span class="string-literal">&quot;</span><span class="escape-sequence">\n</span><span class="string-literal">&quot;</span><span>)
    </span><span class="comment">// rule #1: input must be UTF-8 encoded
</span><span>    .</span><span class="identifier">through</span><span>(</span><span class="identifier">fs2</span><span>.</span><span class="identifier">text</span><span>.</span><span class="identifier">utf8</span><span>.</span><span class="identifier">encode</span><span>)</span></code></pre>
        <p>Using this function, we can generate JSON Lines encoded data out of a <a href="../data/json/sample.json">sample JSON array</a></p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">fs2</span><span>.</span><span class="identifier">data</span><span>.</span><span class="identifier">json</span><span>.</span><span class="identifier">jsonpath</span><span>.</span><span class="identifier">literals</span><span>.</span><span class="identifier">_</span><span>

</span><span class="type-name">Files</span><span>[</span><span class="type-name">IO</span><span>]
  .</span><span class="identifier">readAll</span><span>(</span><span class="type-name">Path</span><span>(</span><span class="string-literal">&quot;site/cookbooks/data/json/sample.json&quot;</span><span>))
  .</span><span class="identifier">through</span><span>(</span><span class="identifier">fs2</span><span>.</span><span class="identifier">text</span><span>.</span><span class="identifier">utf8</span><span>.</span><span class="identifier">decode</span><span>)
  .</span><span class="identifier">through</span><span>(</span><span class="identifier">fs2</span><span>.</span><span class="identifier">data</span><span>.</span><span class="identifier">json</span><span>.</span><span class="identifier">tokens</span><span>)
  .</span><span class="identifier">through</span><span>(</span><span class="identifier">fs2</span><span>.</span><span class="identifier">data</span><span>.</span><span class="identifier">json</span><span>.</span><span class="identifier">jsonpath</span><span>.</span><span class="identifier">filter</span><span>.</span><span class="identifier">values</span><span>(</span><span class="string-literal">jsonpath&quot;$$[0:4]&quot;</span><span>))
  .</span><span class="identifier">through</span><span>(</span><span class="identifier">writeJsonLines</span><span>)
  .</span><span class="identifier">through</span><span>(</span><span class="identifier">fs2</span><span>.</span><span class="identifier">text</span><span>.</span><span class="identifier">utf8</span><span>.</span><span class="identifier">decode</span><span>)
  .</span><span class="identifier">compile</span><span>
  .</span><span class="identifier">string</span><span>
  .</span><span class="identifier">unsafeRunSync</span><span>()
</span><span class="comment">// res2: String = &quot;&quot;&quot;{
// &quot;name&quot;:
// &quot;Adeel Solangi&quot;
// ,
// &quot;language&quot;:
// &quot;Sindhi&quot;
// ,
// &quot;id&quot;:
// &quot;V59OF92YF627HFY0&quot;
// ,
// &quot;bio&quot;:
// &quot;Donec lobortis eleifend condimentum. Cras dictum dolor lacinia lectus vehicula rutrum. Maecenas quis nisi nunc. Nam tristique feugiat est vitae mollis. Maecenas quis nisi nunc.&quot;
// ,
// &quot;version&quot;:
// 6.1
// }
// {
// &quot;name&quot;:
// &quot;Afzal Ghaffar&quot;
// ,
// &quot;language&quot;:
// &quot;Sindhi&quot;
// ,
// &quot;id&quot;:
// &quot;ENTOCR13RSCLZ6KU&quot;
// ,
// &quot;bio&quot;:
// &quot;Aliquam sollicitudin ante ligula, eget malesuada nibh efficitur et. Pellentesque massa sem, scelerisque sit amet odio id, cursus tempor urna. Etiam congue dignissim volutpat. Vestibulum pharetra libero et velit gravida euismod.&quot;
// ,
// &quot;version&quot;:
// 1.88
// }
// {
// &quot;name&quot;:
// &quot;Aamir Solangi&quot;
// ,
// &quot;language&quot;:
// &quot;Sindhi&quot;
// ,
// &quot;id&quot;:
// &quot;IAKPO3R4761JDRVG&quot;
// ,
// &quot;bio&quot;:
// &quot;Vestibulum pharetra libero et velit gravida euismod. Quisque mauris ligula, efficitur porttitor sodales ac, lacinia non ex. Fusce eu ultrices elit, vel posuere...</span></code></pre>
        
        <h2 id="running-the-full-example" class="section"><a class="anchor-link left" href="#running-the-full-example"><i class="icofont-laika link">&#xef71;</i></a>Running the full example</h2>
        <p>The full code can be found in the repository as a <a href="https://scala-cli.virtuslab.org/">Scala CLI</a> <a href="../scripts/jsonlines.scala">script</a>.
        This example uses <a href="https://ben.kirw.in/decline/">decline</a> to parse the CLI options.</p>
        <div class="tab-container" data-tab-group="platform">
          <ul class="tab-group">
            <li class="tab active" data-choice-name="jvm"><a href="#">JVM</a></li>
            <li class="tab" data-choice-name="js"><a href="#">Scala.JS</a></li>
            <li class="tab" data-choice-name="native"><a href="#">Scala Native</a></li>
          </ul>
          <div class="tab-content active" data-choice-name="jvm">
            <pre class="keep-together pdf epub"><code class="nohighlight"><span>$ scala-cli site/cookbooks/scripts/jsonlines.scala -- </span><span class="identifier">read</span><span> site/cookbooks/data/jsonl/nested.jsonl</span></code></pre>
          </div>
          <div class="tab-content" data-choice-name="js">
            <pre class="keep-together pdf epub"><code class="nohighlight"><span>$ scala-cli --js site/cookbooks/scripts/jsonlines.scala -- </span><span class="identifier">read</span><span> site/cookbooks/data/jsonl/nested.jsonl</span></code></pre>
          </div>
          <div class="tab-content" data-choice-name="native">
            <pre class="keep-together pdf epub"><code class="nohighlight"><span>$ scala-cli --native site/cookbooks/scripts/jsonlines.scala -- </span><span class="identifier">read</span><span> site/cookbooks/data/jsonl/nested.jsonl</span></code></pre>
          </div>
        </div>

        
<hr class="footer-rule"/>
<footer>
  <code>fs2-data</code> is a <a href="https://typelevel.org/">Typelevel</a> affiliate project distributed under the <a href="https://www.apache.org/licenses/LICENSE-2.0.txt">Apache-2.0</a> license.
</footer>


      </main>

    </div>

  </body>

</html>