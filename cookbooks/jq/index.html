<!DOCTYPE html>
<html lang="en">
  
  <head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Typelevel Laika + Helium Theme" />
  <title>Reading/transforming/writing JSON data</title>
  
  <meta name="author" content="Lucas Satabin"/>
  
  <meta name="author" content="Yannick Heiber"/>
  
  
  <meta name="description" content="site"/>
  
  
  
  <link rel="icon" sizes="32x32" type="image/png" href="https://typelevel.org/img/favicon.png"/>
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700">
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono:500">
  
  <link rel="stylesheet" type="text/css" href="/pagefind/pagefind-ui.css" />
    <link rel="stylesheet" type="text/css" href="../../helium/site/icofont.min.css" />
    <link rel="stylesheet" type="text/css" href="../../helium/site/laika-helium.css" />
  <script src="/pagefind/pagefind-ui.js"></script>
    <script src="../../helium/site/laika-helium.js"></script>
    <script type="module">

import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
const dark = window.matchMedia('(prefers-color-scheme: dark)').matches;
mermaid.initialize({ 
  startOnLoad: true,
  theme: "base",
  themeVariables: {
    'darkMode': dark,
    'primaryColor': dark ? '#f4f8fa' : '#f4f8fa', 
    'primaryTextColor': dark ? '#385a70' : '#385a70',
    'primaryBorderColor': dark ? '#8ebac7' : '#8ebac7',
    'lineColor': dark ? '#385a70' : '#385a70',
    'background': dark ? '#ffffff' : '#ffffff',
  }
});

</script>
  
  
  <script> /* for avoiding page load transitions */ </script>
</head>

  <body>

    <header id="top-bar" class="light-default dark-default">

  <div class="row">
    <a id="nav-icon">
      <i class="icofont-laika navigationMenu" title="Navigation">&#xefa2;</i>
    </a>
    
    
  </div>

  <a class="image-link" href="../../"><img src="../../media/logo-header.svg"></a>

  <div class="row links">
    
    <a class="icon-link svg-link" href="https://www.javadoc.io/doc/org.gnieh/fs2-data-docs_2.13/1.10.0/fs2/data/index.html"><span class="api" title="API"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M75,47.5c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm-50,-0c13.246,-0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,-0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm2.705,16.735l7.239,0l0.622,-4.904l-21.833,0l-0,4.904l7.589,0l0,22.067l6.383,0l-0,-22.067Zm58.076,7.265c-0,-8.757 -3.698,-14.166 -10.781,-14.166c-7.083,-0 -10.781,5.604 -10.781,14.166c0,8.757 3.698,14.166 10.781,14.166c7.083,0 10.781,-5.604 10.781,-14.166Zm-6.539,0c0,6.538 -1.128,9.496 -4.242,9.496c-2.997,0 -4.242,-2.88 -4.242,-9.496c-0,-6.616 1.206,-9.496 4.242,-9.496c3.036,-0 4.242,2.88 4.242,9.496Zm-29.242,-67c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm0.512,9.834c-7.122,-0 -12.609,5.098 -12.609,14.127c-0,9.263 5.215,14.205 12.532,14.205c4.164,0 7.083,-1.634 9.068,-3.658l-2.88,-3.697c-1.518,1.206 -3.153,2.413 -5.838,2.413c-3.697,-0 -6.266,-2.763 -6.266,-9.263c-0,-6.616 2.724,-9.379 6.149,-9.379c2.102,-0 3.892,0.778 5.371,1.984l3.113,-3.775c-2.257,-1.868 -4.748,-2.957 -8.64,-2.957Z"/>
  </g>
</svg></span></a>
    
    <a class="icon-link svg-link" href="https://github.com/gnieh/fs2-data"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
    <a class="icon-link glyph-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika chat" title="Chat">&#xeed5;</i></a>
    
    <a class="icon-link svg-link" href="https://fosstodon.org/@lucassatabin"><span class="mastodon" title="Mastodon"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <g class="svg-shape">
    <path d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a3.614 3.614 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522c0-.859.22-1.541.66-2.046.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764.442.505.661 1.187.661 2.046v4.203z"/>
  </g>
</svg></span></a>
    
  </div>  

</header>
    
    <nav id="sidebar">

  <div class="row">
    
    <a class="icon-link svg-link" href="https://www.javadoc.io/doc/org.gnieh/fs2-data-docs_2.13/1.10.0/fs2/data/index.html"><span class="api" title="API"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M75,47.5c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm-50,-0c13.246,-0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,-0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm2.705,16.735l7.239,0l0.622,-4.904l-21.833,0l-0,4.904l7.589,0l0,22.067l6.383,0l-0,-22.067Zm58.076,7.265c-0,-8.757 -3.698,-14.166 -10.781,-14.166c-7.083,-0 -10.781,5.604 -10.781,14.166c0,8.757 3.698,14.166 10.781,14.166c7.083,0 10.781,-5.604 10.781,-14.166Zm-6.539,0c0,6.538 -1.128,9.496 -4.242,9.496c-2.997,0 -4.242,-2.88 -4.242,-9.496c-0,-6.616 1.206,-9.496 4.242,-9.496c3.036,-0 4.242,2.88 4.242,9.496Zm-29.242,-67c13.246,0 24,10.754 24,24c0,13.246 -10.754,24 -24,24c-13.246,0 -24,-10.754 -24,-24c0,-13.246 10.754,-24 24,-24Zm0.512,9.834c-7.122,-0 -12.609,5.098 -12.609,14.127c-0,9.263 5.215,14.205 12.532,14.205c4.164,0 7.083,-1.634 9.068,-3.658l-2.88,-3.697c-1.518,1.206 -3.153,2.413 -5.838,2.413c-3.697,-0 -6.266,-2.763 -6.266,-9.263c-0,-6.616 2.724,-9.379 6.149,-9.379c2.102,-0 3.892,0.778 5.371,1.984l3.113,-3.775c-2.257,-1.868 -4.748,-2.957 -8.64,-2.957Z"/>
  </g>
</svg></span></a>
    
    <a class="icon-link svg-link" href="https://github.com/gnieh/fs2-data"><span class="github" title="Source Code"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 100 100" version="1.1" xmlns="http://www.w3.org/2000/svg" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
  <g class="svg-shape">
    <path d="M49.995,1c-27.609,-0 -49.995,22.386 -49.995,50.002c-0,22.09 14.325,40.83 34.194,47.444c2.501,0.458 3.413,-1.086 3.413,-2.412c0,-1.185 -0.043,-4.331 -0.067,-8.503c-13.908,3.021 -16.843,-6.704 -16.843,-6.704c-2.274,-5.773 -5.552,-7.311 -5.552,-7.311c-4.54,-3.103 0.344,-3.042 0.344,-3.042c5.018,0.356 7.658,5.154 7.658,5.154c4.46,7.64 11.704,5.433 14.552,4.156c0.454,-3.232 1.744,-5.436 3.174,-6.685c-11.102,-1.262 -22.775,-5.553 -22.775,-24.713c-0,-5.457 1.949,-9.92 5.147,-13.416c-0.516,-1.265 -2.231,-6.348 0.488,-13.233c0,0 4.199,-1.344 13.751,5.126c3.988,-1.108 8.266,-1.663 12.518,-1.682c4.245,0.019 8.523,0.574 12.517,1.682c9.546,-6.47 13.736,-5.126 13.736,-5.126c2.728,6.885 1.013,11.968 0.497,13.233c3.204,3.496 5.141,7.959 5.141,13.416c0,19.209 -11.691,23.436 -22.83,24.673c1.795,1.544 3.394,4.595 3.394,9.26c0,6.682 -0.061,12.076 -0.061,13.715c0,1.338 0.899,2.894 3.438,2.406c19.853,-6.627 34.166,-25.354 34.166,-47.438c-0,-27.616 -22.389,-50.002 -50.005,-50.002"/>
  </g>
</svg></span></a>
    
    <a class="icon-link glyph-link" href="https://discord.gg/XF3CXcMzqD"><i class="icofont-laika chat" title="Chat">&#xeed5;</i></a>
    
    <a class="icon-link svg-link" href="https://fosstodon.org/@lucassatabin"><span class="mastodon" title="Mastodon"><svg class="svg-icon" width="100%" height="100%" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <g class="svg-shape">
    <path d="M11.19 12.195c2.016-.24 3.77-1.475 3.99-2.603.348-1.778.32-4.339.32-4.339 0-3.47-2.286-4.488-2.286-4.488C12.062.238 10.083.017 8.027 0h-.05C5.92.017 3.942.238 2.79.765c0 0-2.285 1.017-2.285 4.488l-.002.662c-.004.64-.007 1.35.011 2.091.083 3.394.626 6.74 3.78 7.57 1.454.383 2.703.463 3.709.408 1.823-.1 2.847-.647 2.847-.647l-.06-1.317s-1.303.41-2.767.36c-1.45-.05-2.98-.156-3.215-1.928a3.614 3.614 0 0 1-.033-.496s1.424.346 3.228.428c1.103.05 2.137-.064 3.188-.189zm1.613-2.47H11.13v-4.08c0-.859-.364-1.295-1.091-1.295-.804 0-1.207.517-1.207 1.541v2.233H7.168V5.89c0-1.024-.403-1.541-1.207-1.541-.727 0-1.091.436-1.091 1.296v4.079H3.197V5.522c0-.859.22-1.541.66-2.046.456-.505 1.052-.764 1.793-.764.856 0 1.504.328 1.933.983L8 4.39l.417-.695c.429-.655 1.077-.983 1.934-.983.74 0 1.336.259 1.791.764.442.505.661 1.187.661 2.046v4.203z"/>
  </g>
</svg></span></a>
    
  </div>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="../../">Home</a></li>
    <li class="level1 nav-header">documentation</li>
    <li class="level2 nav-leaf"><a href="../../documentation/">Introduction</a></li>
    <li class="level2 nav-header">csv</li>
    <li class="level3 nav-leaf"><a href="../../documentation/csv/">Introduction</a></li>
    <li class="level3 nav-leaf"><a href="../../documentation/csv/generic/">Generic</a></li>
    <li class="level2 nav-header">json</li>
    <li class="level3 nav-leaf"><a href="../../documentation/json/">Introduction</a></li>
    <li class="level3 nav-leaf"><a href="../../documentation/json/jsonpath/">JSONPath</a></li>
    <li class="level3 nav-leaf"><a href="../../documentation/json/jq/">JSON Queries</a></li>
    <li class="level3 nav-leaf"><a href="../../documentation/json/libraries/">JSON Libraries</a></li>
    <li class="level3 nav-leaf"><a href="../../documentation/json/jsonpatch/">JSON Patch</a></li>
    <li class="level3 nav-leaf"><a href="../../documentation/json/transformations/">Transformations</a></li>
    <li class="level2 nav-header">xml</li>
    <li class="level3 nav-leaf"><a href="../../documentation/xml/">Introduction</a></li>
    <li class="level3 nav-leaf"><a href="../../documentation/xml/xpath/">XPath</a></li>
    <li class="level3 nav-leaf"><a href="../../documentation/xml/libraries/">XML Libraries</a></li>
    <li class="level2 nav-header">cbor</li>
    <li class="level3 nav-leaf"><a href="../../documentation/cbor/">Introduction</a></li>
    <li class="level2 nav-header">cbor-json</li>
    <li class="level3 nav-leaf"><a href="../../documentation/cbor-json/">Introduction</a></li>
    <li class="level1 nav-header">cookbooks</li>
    <li class="level2 active nav-leaf"><a href="#">Reading/transforming/writing JSON data</a></li>
    <li class="level2 nav-leaf"><a href="../jsonlines/">Handling JSON Lines data</a></li>
  </ul>

  <ul class="nav-list">
    <li><div id="search"></div></li>
  </ul>

</nav>

<script>
window.addEventListener('DOMContentLoaded', (event) => {
  new PagefindUI({ element: "#search", showSubResults: true, showImages: false });
});
</script>


    <div id="container">

      
<nav id="page-nav">
  <p class="header"><a href="#">Reading/transforming/writing JSON data</a></p>

  <ul class="nav-list">
    <li class="level1 nav-leaf"><a href="#high-level-overview">High-level overview</a></li>
    <li class="level1 nav-node"><a href="#basic-implementation">Basic implementation</a></li>
    <li class="level2 nav-leaf"><a href="#reading-and-writing">Reading and writing</a></li>
    <li class="level2 nav-leaf"><a href="#parsing-and-printing">Parsing and printing</a></li>
    <li class="level2 nav-leaf"><a href="#transforming">Transforming</a></li>
    <li class="level1 nav-leaf"><a href="#running-the-full-example">Running the full example</a></li>
  </ul>

  <p class="footer"></p>
</nav>


      <main class="content">

        <h1 id="reading-transforming-writing-json-data" class="title">Reading/transforming/writing JSON data</h1>
        <p>In this cookbook we will demonstrate an example of how the JSON tools provided by <code>fs2-data</code> can be used to build a mini <code>jq</code>-like CLI tool.</p>
        
        <h2 id="high-level-overview" class="section"><a class="anchor-link left" href="#high-level-overview"><i class="icofont-laika link">&#xef71;</i></a>High-level overview</h2>
        <p>The general approach to reading/parsing/transforming/generating data with <code>fs2-data</code> can be summarized as follows:</p>
        <pre class="mermaid">graph LR
Reading(Reading) --&gt; Parsing --&gt; Transforming --&gt; Printing --&gt; Writing(Writing)</pre>
        <p>The <em>Reading</em> and <em>Writing</em> steps are not specific to <code>fs2-data</code> but rely on pure <code>fs2</code> operators or other compatible libraries. The <em>Parsing</em>, <em>Transforming</em>, and <em>Printing</em> phases will use the tools provided by <code>fs2-data-json</code> and more specifically:</p>
        <ul>
          <li>The <code>tokens</code> pipe to parse the input stream into JSON <a class="api" href="https://www.javadoc.io/doc/org.gnieh/fs2-data-docs_2.13/1.10.0/fs2/data/fs2/data/json/Token.html">Token</a>s (see <a href="../../documentation/json/#json-parsing">the documentation</a> for more details).</li>
        </ul>
        <ul>
          <li>The <a class="api" href="https://www.javadoc.io/doc/org.gnieh/fs2-data-docs_2.13/1.10.0/fs2/data/fs2/data/json/jq/Compiler.html">Compiler</a> class to compile a query into a pipe (see <a href="../../documentation/json/jq/#using-queries">the documentation</a> for more details).</li>
        </ul>
        <ul>
          <li>The <code>render.pretty</code> pipe to render the query result into a pretty-printed JSON string (see <a href="../../documentation/json/#json-renderers">the documentation</a> for more details).</li>
        </ul>
        <p>In general the <em>Transforming</em> step can use whatever operator fits your purpose, from <code>fs2</code> or any other <code>fs2</code>-based library. But in our case the only transformation will be performed by the query.</p>
        
        <h2 id="basic-implementation" class="section"><a class="anchor-link left" href="#basic-implementation"><i class="icofont-laika link">&#xef71;</i></a>Basic implementation</h2>
        
        <h3 id="reading-and-writing" class="section"><a class="anchor-link left" href="#reading-and-writing"><i class="icofont-laika link">&#xef71;</i></a>Reading and writing</h3>
        <p>In this example, we will read the content from a <a href="../data/json/sample.json">sample JSON file</a> and write the result to stdout.
        To this end, we will use the operators and pipes provided by <code>fs2-io</code>.</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">effect</span><span>.</span><span class="type-name">IO</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">cats</span><span>.</span><span class="identifier">effect</span><span>.</span><span class="identifier">unsafe</span><span>.</span><span class="identifier">implicits</span><span>.</span><span class="identifier">global</span><span>

</span><span class="keyword">import</span><span> </span><span class="identifier">fs2</span><span>.</span><span class="identifier">io</span><span>.</span><span class="identifier">file</span><span>.{</span><span class="type-name">Files</span><span>, </span><span class="type-name">Path</span><span>}
</span><span class="keyword">import</span><span> </span><span class="identifier">fs2</span><span>.</span><span class="identifier">io</span><span>.</span><span class="identifier">stdout</span><span>
</span><span class="keyword">import</span><span> </span><span class="identifier">fs2</span><span>.</span><span class="identifier">text</span><span>.</span><span class="identifier">utf8</span><span>

</span><span class="type-name">Files</span><span>[</span><span class="type-name">IO</span><span>]
  .</span><span class="identifier">readUtf8</span><span>(</span><span class="type-name">Path</span><span>(</span><span class="string-literal">&quot;site/cookbooks/data/json/sample.json&quot;</span><span>))
  .</span><span class="identifier">through</span><span>(</span><span class="identifier">utf8</span><span>.</span><span class="identifier">encode</span><span>[</span><span class="type-name">IO</span><span>])
  .</span><span class="identifier">through</span><span>(</span><span class="identifier">stdout</span><span>)
  .</span><span class="identifier">compile</span><span>
  .</span><span class="identifier">drain</span><span>
  .</span><span class="identifier">unsafeRunSync</span><span>()</span></code></pre>
        <p>This snippet is pure <code>fs2</code> and does not involve <code>fs2-data</code> at any point.</p>
        
        <h3 id="parsing-and-printing" class="section"><a class="anchor-link left" href="#parsing-and-printing"><i class="icofont-laika link">&#xef71;</i></a>Parsing and printing</h3>
        <p>The next step would be to parse and render the JSON data, using the appropriate <code>fs2-data</code> pipes. This can be achieved this way:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">fs2</span><span>.</span><span class="identifier">data</span><span>.</span><span class="identifier">json</span><span>

</span><span class="type-name">Files</span><span>[</span><span class="type-name">IO</span><span>]
  .</span><span class="identifier">readUtf8</span><span>(</span><span class="type-name">Path</span><span>(</span><span class="string-literal">&quot;site/cookbooks/data/json/sample.json&quot;</span><span>))
  .</span><span class="identifier">through</span><span>(</span><span class="identifier">json</span><span>.</span><span class="identifier">tokens</span><span>) </span><span class="comment">// parsing JSON input
</span><span>  .</span><span class="identifier">through</span><span>(</span><span class="identifier">json</span><span>.</span><span class="identifier">render</span><span>.</span><span class="identifier">pretty</span><span>()) </span><span class="comment">// pretty printing JSON stream
</span><span>  .</span><span class="identifier">through</span><span>(</span><span class="identifier">utf8</span><span>.</span><span class="identifier">encode</span><span>[</span><span class="type-name">IO</span><span>])
  .</span><span class="identifier">through</span><span>(</span><span class="identifier">stdout</span><span>)
  .</span><span class="identifier">compile</span><span>
  .</span><span class="identifier">drain</span><span>
  .</span><span class="identifier">unsafeRunSync</span><span>()</span></code></pre>
        
        <h3 id="transforming" class="section"><a class="anchor-link left" href="#transforming"><i class="icofont-laika link">&#xef71;</i></a>Transforming</h3>
        <p>So far the only thing that the code does is to format the input into the output.
        Looking at the input, we see that it consists in an array of objects containing several fields.
        Let&#39;s say we are interested in the <code>name</code> and <code>language</code> fields.
        For each element in the array we would like to emit an object with both fields, but the <code>name</code> oned should be renamed <code>full_name</code>.</p>
        <p>To this end we can write the following query using the <code>jq</code> interpolator:</p>
        <pre><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">fs2</span><span>.</span><span class="identifier">data</span><span>.</span><span class="identifier">json</span><span>.</span><span class="identifier">jq</span><span>.</span><span class="identifier">literals</span><span>.</span><span class="identifier">_</span><span>

</span><span class="keyword">val</span><span> </span><span class="identifier">query</span><span> = </span><span class="string-literal">jq&quot;&quot;&quot;.[] | { &quot;full_name&quot;: .name, &quot;language&quot;: .language }&quot;&quot;&quot;</span><span>
</span><span class="comment">// query: json.jq.Jq = Iterator(
//   filter = Identity,
//   inner = Obj(
//     prefix = Identity,
//     fields = List(
//       (&quot;full_name&quot;, Field(name = &quot;name&quot;)),
//       (&quot;language&quot;, Field(name = &quot;language&quot;))
//     )
//   )
// )</span></code></pre>
        <p>The query can now be compiled into a <code>Pipe</code>:</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="keyword">import</span><span> </span><span class="identifier">fs2</span><span>.</span><span class="identifier">data</span><span>.</span><span class="identifier">json</span><span>.</span><span class="identifier">jq</span><span>.</span><span class="type-name">Compiler</span><span>

</span><span class="keyword">val</span><span> </span><span class="identifier">queryCompiler</span><span> = </span><span class="type-name">Compiler</span><span>[</span><span class="type-name">IO</span><span>]
</span><span class="comment">// queryCompiler: Compiler[IO] = fs2.data.json.jq.internal.ESPJqCompiler@40f82cb8
</span><span>
</span><span class="keyword">val</span><span> </span><span class="identifier">queryPipe</span><span> = </span><span class="identifier">queryCompiler</span><span>.</span><span class="identifier">compile</span><span>(</span><span class="identifier">query</span><span>).</span><span class="identifier">unsafeRunSync</span><span>()
</span><span class="comment">// queryPipe: fs2.package.Pipe[IO, json.Token, json.Token] = &lt;function1&gt;</span></code></pre>
        <p>Now this pipe can be used to transform the data within the previous pipeline</p>
        <pre class="keep-together pdf epub"><code class="nohighlight"><span class="type-name">Files</span><span>[</span><span class="type-name">IO</span><span>]
  .</span><span class="identifier">readUtf8</span><span>(</span><span class="type-name">Path</span><span>(</span><span class="string-literal">&quot;site/cookbooks/data/json/sample.json&quot;</span><span>))
  .</span><span class="identifier">through</span><span>(</span><span class="identifier">json</span><span>.</span><span class="identifier">tokens</span><span>)
  .</span><span class="identifier">through</span><span>(</span><span class="identifier">queryPipe</span><span>) </span><span class="comment">// the transformation using the query pipe
</span><span>  .</span><span class="identifier">through</span><span>(</span><span class="identifier">json</span><span>.</span><span class="identifier">render</span><span>.</span><span class="identifier">pretty</span><span>())
  .</span><span class="identifier">through</span><span>(</span><span class="identifier">utf8</span><span>.</span><span class="identifier">encode</span><span>[</span><span class="type-name">IO</span><span>])
  .</span><span class="identifier">through</span><span>(</span><span class="identifier">stdout</span><span>)
  .</span><span class="identifier">compile</span><span>
  .</span><span class="identifier">drain</span><span>
  .</span><span class="identifier">unsafeRunSync</span><span>()</span></code></pre>
        <p>And you get the result of the query execution printed to stdout.</p>
        
        <h2 id="running-the-full-example" class="section"><a class="anchor-link left" href="#running-the-full-example"><i class="icofont-laika link">&#xef71;</i></a>Running the full example</h2>
        <p>The full code can be found in the repository in the <a class="source" href="https://github.com/gnieh/fs2-data/tree/main/examples/jqlike/src/main/scala/fs2/data/example/jqlike/JqLike.scala">JqLike</a> object.
        This example uses <a href="https://ben.kirw.in/decline/">decline</a> to parse the CLI options.</p>
        <p>It compiles for all three supported platforms:</p>
        <ul>
          <li>as a fat jar using <a href="https://github.com/sbt/sbt-assembly">sbt-assembly</a> for JVM</li>
        </ul>
        <ul>
          <li>as a native executable using <a href="https://scala-native.org/en/latest/">Scala Native</a></li>
        </ul>
        <ul>
          <li>as a Node.js application using <a href="https://www.scala-js.org">Scala.js</a></li>
        </ul>
        <div class="tab-container" data-tab-group="platform">
          <ul class="tab-group">
            <li class="tab active" data-choice-name="jvm"><a href="#">JVM</a></li>
            <li class="tab" data-choice-name="native"><a href="#">Scala Native</a></li>
            <li class="tab" data-choice-name="js"><a href="#">Scala.JS</a></li>
          </ul>
          <div class="tab-content active" data-choice-name="jvm">
            <pre class="keep-together pdf epub"><code class="nohighlight"><span>$ sbt exampleJqJVM/assembly
$ java -jar examples/jqlike/.jvm/target/scala-</span><span class="number-literal">2.13</span><span>/jq-like.jar -q </span><span class="string-literal">&#39;.[] | { &quot;full_name&quot;: .name, &quot;language&quot;: .language }&#39;</span><span> -f site/cookbooks/data/json/sample.json</span></code></pre>
          </div>
          <div class="tab-content" data-choice-name="native">
            <pre class="keep-together pdf epub"><code class="nohighlight"><span>$ sbt exampleJqNative/nativeLink
$ examples/jqlike/.native/target/scala-</span><span class="number-literal">2.13</span><span>/jq-like-out -q </span><span class="string-literal">&#39;.[] | { &quot;full_name&quot;: .name, &quot;language&quot;: .language }&#39;</span><span> -f site/cookbooks/data/json/sample.json</span></code></pre>
          </div>
          <div class="tab-content" data-choice-name="js">
            <pre class="keep-together pdf epub"><code class="nohighlight"><span>$ sbt exampleJqJS/fastLinkJS
$ node examples/jqlike/.js/target/scala-</span><span class="number-literal">2.13</span><span>/jq-like-fastopt/main.js -q </span><span class="string-literal">&#39;.[] | { &quot;full_name&quot;: .name, &quot;language&quot;: .language }&#39;</span><span> -f site/cookbooks/data/json/sample.json</span></code></pre>
          </div>
        </div>

        
<hr class="footer-rule"/>
<footer>
  <code>fs2-data</code> is a <a href="https://typelevel.org/">Typelevel</a> affiliate project distributed under the <a href="https://www.apache.org/licenses/LICENSE-2.0.txt">Apache-2.0</a> license.
</footer>


      </main>

    </div>

  </body>

</html>